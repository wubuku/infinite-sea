# README

[English](./README.md) | 中文版

我们使用 dddappp 这个低代码平台来开发这个游戏。虽然 dddappp 并不是专门为游戏开发设计的，但是它完全可以作为一个“全链游戏引擎”来使用。

使用 dddappp 开发全链游戏令人难以置信地简单。

我们只要先做好需求分析和领域建模，然后编写 DDDML 模型文件，再运行 dddappp 创建工具，生成大部分代码，然后在某些特定地方填充少量的业务逻辑的实现，就可以完成一个全链游戏的开发。

## 需求分析与领域建模

### Items

在当前领域模型中，Items 表示“物品”。

### Skills

Items（物品）可以由两种方式“生产/创造”出来：

* Item Production。需要“原材料”，生产时需要消耗一定数量的原材料（其他 Items，比如从CottonSeeds->Cottons）。
* Item Creation。不需要原材料。

同一种东西（Item），是可能可以通过不同的技能（Skill）获得的。比如你可以通过 “Farming” 技能种植、收获一种农产品，也可以“偷窃”技能获得它。

Skill（技能）要么是生产（Production）型的技能，要么是创造（Creation）型的技能，不会两者都是。比如：

* Farming（农业）是生产型的技能。需要消耗“种子”（原材料 items）。种子可以从市场购买、可以“偷窃”（偷窃是创造型的技能）或者使用其他技能获得。
* Mining（挖矿）和 Woodcutting（伐木）是创造型的技能。
  * 我们需要给玩家对这些创造型技能的使用做一些限制。
  * 严格来说，它不太像生产型技能那样，后者主要是通过设置“生产配方”所需的（可能是多种）原材料 item 和数量来达到对技能的使用限制。
  * 不过，仍然可以将“一种创造型技能的使用配额”抽象为一个特殊的 Item(Id) 和 quantity 的 pair。

### Item Creation 和 Item Production

可以将它们理解为“生产配方”。

### Skill Processes

实体 Skill Process（技能流程）表示执行 Item Production 或 Item Creation 的过程。
一个通俗的比喻：Skill Process 就是“生产线”。

#### Item Production 的 Skill Process

执行 Skill Process 生产 Item，对于大多数 Item，生产成果只需要使用“Item ID 和数量”表示就可以了。

但是 Skill Process 还需要有一些用来制造“Item 的独特个体”的方法。

* 在 MVP 版本中，具有“独特个体”的 Item 主要指的是 Ship。所以，我们给 SkillProcess 定义了 StartShipProduction / CompleteShipProduction 方法。
* 方法 StartShipProduction 的参数列表应该包含表示“实际投入的材料数量”的信息，因为它们可以大于 Item Production 中规定的（最少）数量。

[TBD]


### 一些技术细节问题的讨论结果

产品设计的需求是：
假设岛屿均匀分布在地图上, 相邻的岛屿之间（从 A 岛 到离它最近的 B岛）的航行时间应该是 20 分钟——以 speed 为 5 的船/船队的速度计算。

#### 位置坐标的表示问题

讨论结果：

* 合约（后端）的坐标值以 u32（无符号 32 位整数，其最大值为 `4,294,967,295`）表示，因为主流的智能合约语言（包括 Move）一般都没有“有符号整数”的类型。
* 在链上**不**打算使用补码的形式在 u32 类型的字段中存储（正 / 负）坐标值，因为这样会明显增加位置计算逻辑的复杂度。
* 前端可以执行坐标变换，可以将合约中存储的 u32 整数坐标值换算为 i32 坐标值（有符号 32 位整数）。
  可以考虑将原始的 u32 坐标值减去 i32 位整数的最大值 `2,147,483,647` ， 得到负数或者正数表示的坐标值。
  即以 u32 坐标值表示的地图的中心点为 `("2,147,483,647", "2,147,483,647")`。

#### 相邻岛屿的距离和岛屿坐标的确定

相邻岛屿的平均距离是 7070。
因为我们让每个岛屿默认在地图上“占有”一个 5000 * 5000 的一个格子（可以想象为“领海”），
那么这个格子的对角的直线距离是 5000 * 1.414，约等于 7070。

如果确定每个岛屿默认占有一个 5000 * 5000 的格子，
那么，举例来说，当我们确定开放 50000 * 50000 的地图区域时，就大致会在这个区域放入 100 个岛屿。
反过来计算也可以，即可以根据打算开放的岛屿数量，确定要开放的地图的区域的大小（宁大毋小）。

在开放的区域确定每个岛屿的位置坐标的过程可以是：

* 先给每个岛屿分配默认的坐标值，即把岛屿放在它所占的“格子”的中心。
* 然后，产生两个随机数，随机数的范围是 +/- 5000 * 30%（这个 30% 是举例说明，具体的随机“幅度”可以讨论）。把随机数加到默认的坐标值上，得到最终坐标值。


#### 速度的单位转换问题

产品需求是：Speed 属性值 为 5 的船队，在相邻的两个岛屿之间航行，平均需要 20 分钟。

相邻岛屿的平均距离为 7070 个最小坐标单位。
所以可以明确 Ship 的 speed 属性值和以 `“最小坐标单位 / 秒”` 表示的速度值之间的转换关系：

* Speed 属性值为 5 的船队，航行速度为：每秒 (7070 / 1200) 个最小坐标单位。即每秒 5.892 个最小坐标单位。
* Speed 属性值每 +/- 1，船队的速度增加/减少 10%。

注：后端合约中，时间点是以“秒”计量的 Unix 时间。即从 1970 年 1 月 1 日 0 时 0 分 0 秒开始的秒数。


#### 航行的 Energy Token 消耗计算

产品需求是：每艘船航行一小时，消耗 5 个 Energy Token。

因 Energy Token 的小数点位数是 9，所以每艘船每秒钟消耗 1388889 个 nano Energy Token。


#### 船队的当前位置问题

* 要更新“船队”在链上的位置状态，需要发送交易（消耗 Gas / 产生费用），所以船队的链上状态可能不适宜“实时”更新。
  那么，很多时候船队的“实时位置”可能需要链下计算。这里的链下包括前端（浏览器）链下服务（indexer）。
* 当船队处于航行状态，那么可能需要根据这些属性来计算船队的当前位置：
  * 最后一次更新的坐标；
  * 航行的目标位置坐标；
  * 船队的移动速度；
  * 最后一次更新坐标的时间。
* 链下计算“当前位置”可能会得出这样一个结果：船队已经到达目的地，实际上处于“停泊”状态。
* 当然，链上状态也不能总是不更新，在有机会发送“交易”上链的时候，触发合约的“船队状态更新逻辑”即可。（目前在很多“交易”执行时，合约的实现都“顺带”更新了相关船队的位置，比如“发起战斗”的时候。）
* 船队位置的链下计算逻辑需要和链上（合约）的计算逻辑保持一致。
  * 虽然最终状态是以“链上状态”为准，但是链下的计算逻辑如果出错可能会导致不好的用户体验。（即：按照链下计算结果，一笔交易所需要的前置条件已经满足，但是在提交到链上执行的时候发生失败。）
  * 链上合约的“当前位置”的计算逻辑见 [direct_route_util.move](./sui-contracts/infinite-sea-common/sources/utils/direct_route_util.move)。
  * 链上合约的船队位置状态的更新逻辑见 [roster_update_location_logic.move](./sui-contracts/infinite-sea/sources/roster_update_location_logic.move)。

#### 事件订阅机制的测试

在 Ship Battle 发生时，前端交互对于实时性的要求可能比较高。（不知每轮 10 秒的出招时间是否足够？）

* 链的状态达到终结性是需要一点时间的；特别是节点的部分查询接口，是依赖（它内部的）“索引服务”实现的，这些接口可能多少会有所延迟。
* 前端最好先做一些测试，通过订阅链上事件的方式，看看是不是可以获得足够快的实时性（不知 Sui TS SDK 是否封装了订阅事件的方法）。

## 编码

### 编写 DDDML 模型文件

模型文件位于目录 `./dddml` 下。

> **Tip**
> 
> About DDDML, here is an introductory article: ["Introducing DDDML: The Key to Low-Code Development for Decentralized Applications"](https://github.com/wubuku/Dapp-LCDP-Demo/blob/main/IntroducingDDDML.md).

### 生成代码

在代码库的根目录执行：

```shell
docker run \
-v .:/myapp \
wubuku/dddappp-sui:master \
--dddmlDirectoryPath /myapp/dddml \
--boundedContextName Dddml.SuiInfiniteSea \
--suiMoveProjectDirectoryPath /myapp/sui-contracts \
--boundedContextSuiPackageName infinite_sea \
--boundedContextJavaPackageName org.dddml.suiinfinitesea \
--javaProjectsDirectoryPath /myapp/sui-java-service \
--javaProjectNamePrefix suiinfinitesea \
--pomGroupId dddml.suiinfinitesea \
--enableMultipleMoveProjects
```

> **提示**
>
> 有时候，你可能需要移除旧的容器和镜像：
>
> ```shell
> docker rm $(docker ps -aq --filter "ancestor=wubuku/dddappp-sui:master")
> docker rmi wubuku/dddappp-sui:master
> ```


### 实现业务逻辑

在生成代码后，我们需要填充一些业务逻辑的实现。

你可以看到，在我们这个代码库的源代码中，所有以 `// <autogenerated>` 开头的文件，都是由 dddappp 工具生成的，我们不应该修改它们。这些代码占了整个代码库的绝大部分。

其他需要我们填充业务逻辑的文件，dddappp 工具也帮我们生成了脚手架代码，也就是函数的签名部分，我们只需要填充其中的“函数体”（body）部分。

具体来说，我们主要是在以 `_logic.move` 结尾的文件中填充模型中定义的“实体的方法”的实现。

如果你在领域模型中定义了“领域服务”，那么，还需要在以 `_service.move` 结尾的文件中填充“领域服务”的实现。
一般来说，它们应该是很薄的一层“包装”代码，只是对领域模型中的实体的方法的组合调用，不会包含复杂的业务逻辑。

值得一提的是，链下服务（off-chain service，有时候会被称为 indexer）是 100% 自动生成的。
你甚至一行代码都不需要写，只需要配置一下发布合约的交易摘要，就可以直接使用了。

#### 程序中使用的常量

#### Item（物品、资源） ID 常量

| Item Id    | Name                    | 说明                         |
|------------|-------------------------|----------------------------|
| 0          | UNUSED_ITEM             | 未使用                        |
| 2          | CottonSeeds             | 棉花种子                       |
| 102        | Cotton                  | 棉花（由棉花种子种植得到）              |
| 200        | Normal Log              | 木头（砍伐的成品）                  |
| 301        | CopperOre               | 铜（挖矿的成品）                   |
| 1000000001 | Ship                    | 船（建造得到）                    |
| 2000000001 | ResourceTypeWoodcutting | 伐木消耗的资源。伐木后可以得到 Normal Log |
| 2000000003 | ResourceTypeMining      | 挖矿消耗的资源。挖矿后可以得到 CooperOre  |

#### 技能常量

| 技能          | 常量 | 说明 |
|-------------|----|----|
| farming     | 0  | 种植 |
| woodcutting | 1  | 伐木 |
| mining      | 3  | 挖矿 |
| crafing     | 6  | 造船 |

## 测试应用

### 发布合约

链上合约包括三个项目（包）：

1. Coin 合约项目
2. NFT 合约项目
3. Common 合约项目
4. Main 合约项目
5. Faucet 合约项目

#### Testnet 发布信息

#### ~~Old（Before 2024-07-11)~~

~~我们在 Sui testnet 上发布以上 3 个合约包，相关信息记录如下：~~

```json
{
  "coin": {
    "PackageId": "0x128dd26366a0a878aeb4836e6af1bd384373492751afa5fdb6ff7e6b819b1547",
    "Digest": "4SLvrvRw83f6DdsdAr2wq7QdRzTzyZiEvuabGFw5z1dZ",
    "EnergyId": "0xd8b9fa7fd1da6f29e3a6914255cdeb267522980d7b158b708c10373dc34905a8",
    "FaucetId": "0x09457dc9803e9f6aadfcbd39894ee6433484a51397e6be5a7149637a230ee9da"
  },
  "common": {
    "Digest": "3jgvvWtKiVYQY4MADu9MZXx1sG9iaoKzS5Fij4ZPD2er",
    "ItemTable": "0x3795f90336763a60f0c552406f78b6ede3d3ba99ad0e8b9d026a816ed342a939",
    "ExperienceTable": "0x3b5670133649b896136e5dfa26e4b608f9662b0320d201403e55d53b37f6e0a7",
    "ItemProductionTable": "0x724c3360f94ad4760b92d5f989f204ecafe4c09e62d8f1c3c32db5ca7b41b0ba",
    "PackageId": "0x80b55c61850000d866f341019365823c32a5f819f784c64c884e5d659e2d5a0f",
    "ItemCreationTable": "0xfa196a0d52dcb11e42edc76507935dcff191a74b9fc500c660816d3ef55c0b3f",
    "ItemCreationMining": "0xcd3d451262118e6aeeb9e94e87c4990dc241f84a7b3aa60b0401cf419caa7dfc",
    "ItemProductionFarming": "0x027729483e9de6996535878788f7a10f3af788889d3e2709766601139198da7a",
    "ItemCreationWooding": "0xfef7bb0b8bf9f028b734e48657250679e2af20b4047f0c89ce099eb9c47636cd",
    "ItemProductionCrafting": "0xd97f7bf2bd3315265c5d37ae6774f0b331263c08e4b7c2b084cd8a863dd787cf"
  },
  "main": {
    "Digest": "28VVTXTpwCwqdJNCcwUPyEMRwp9bjNDHVjSJ9XdNzNfR",
    "RosterTable": "0x61fb2d0e985fa2acd257f4495bf0bc13f083c248bb604317415f08a645138e5c",
    "PackageId": "0x6b5ec168cfe4029fef1abae76c5459bc4203f2186515ab638b6d765465c0e1c7",
    "Publisher": "0x72125115394e65be1dc2d14de9c95b82902802833ed0e6b92d617c6bcbd5756a",
    "SkillProcessTable": "0x897fee0c359ee90de31943bac058d1be1fea2810d1b119d0984b06bd4029d515",
    "Map": "0xd903392c9ef9633bec1338414341e558369726bbbc17aa4d64b2c61547b9a9bd",
    "UpgradeCap": "0xfdd03f8be325c10ecf302d11cde88a4ee220077be1a7eefc3dd1ca0436d354eb"
  }
}
```

#### New 【from 2024-07-11】
```json
{
  "coin": {
    "PackageId": "0x30da2481b152395e2af4d62b10190b84771f4f40d852e61c88552d4899d8529c",
    "TreasuryCap": "0xe07b1d87b000563063bdcb8d737264777868e9b263ac0f50a787daa75efd0c20",
    "Digest": "3FtiPmLGftfXTCLqkU36kX6dbGpwdCPNmTKojt9fyFEJ",
    "EnergyId": "0x446697d5a5e369d1e35107c3e4d1fe210cd32eb5145ef8587283a826f2ba16d6"
  },
  "common": {
    "Digest": "CA6j2THkYBsKPRHuX3Lq4QmRUXeYG6voxAghVKox8XYk",
    "ExperienceTable": "0x1e8672928b0869eb89601fea3b7519811710a62eab6f94f7d8484d02d0006dd9",
    "Publisher": "0x22a709b6a014125c10b7b15e297c88590e2515ee6157156a486ab8fd9ca6a944",
    "ItemProductionTable": "0x25c5bae1608b5d276d3647f4092dc0758da06a8a777eed19c60b935e794a894d",
    "ItemCreationTable": "0x85daa79cc7c4884b18b3c8253eeaaffb400ff58e057d9ecbfaada09a8c2f18ed",
    "ItemTable": "0xe72c77b9469306cf488f2d8c720bf6a0a88f758a048aac765d78231007a12ead",
    "PackageId": "0xeea00d379279065b990e8729c28fe1992ac9cf744c1f964bd816e22dcfb60154",
    "ItemCreationMining": "0x517d091eb7a3ba6c7c6ddffc4bbf1269ddf06a2810202fe04fa4ba6c13f48476",
    "ItemProductionFarming": "0xf5ff1131ba35a0d6c99bd34b3ded3c62734b0e43483c413b9bdc7f4fa260eb56",
    "ItemCreationWooding": "0x7777c7bf152d9bf968e6041589de3fc6d919a6683a19a1fa49dc2a893cff2b78",
    "ItemProductionCrafting": "0x6444f7c09e47132ed86f87dd7d7c1301cf982cd2f3ca948485935da3178db90c"
  },
  "main": {
    "Digest": "6jMenm7Q93M4C4TLiipcgUEvFNr9aMiLfSFHiQKpx1tp",
    "UpgradeCap": "0x6ee38edea1030141546ce8805fb7cdba3471e0924b1ced518c8b6a816683eb0e",
    "Publisher": "0x78a0a9abb2e8fcc6a0aef87fece3e6889e455d05f38c9f7d244ad211a47c433f",
    "AdminCap": "0x895072dde292893f5b7612349e2b42af02d3fab24fe4d418add34ec14c100e4b",
    "PackageId": "0x8d4cae7dba3814ada9ebea4db5f29daab971528c10cb408cb89b5a87cee6c157",
    "SkillProcessTable": "0xa92264ac61a51980b4c59c46128bd64cba343af7cf5904c9d6aff01f901b5fc5",
    "Map": "0xb5099b00256c422349ac2a1dc02708c46b8f235d8999f1a67f7eab61dc7567ec",
    "RosterTable": "0xdbb4074479f178e41bad27c178f1a842d2c91a0de4f239588e4ad2e78ff953b2"
  },
  "faucet": {
    "PackageId": "0x42e44326b9815f5b3833912d3124e8e006ce8110798bd159c04a1ed6bee4a326",
    "EnergyFaucet": "0x8e07d6bc0f4cc87c346324d8f76d8bc5318e646bc37395819587480544198157",
    "Digest": "AKXP8xrx7EZSjy9eK7rfg8ct8HkBkoXX2t8UhFCiwvni"
  },
  "nft": {
    "AvatarChangeTable": "0x4ae64b8b458600d9405032acf27861f4bb135b8a07a72ffcdc6e4e5bea4784d7",
    "Publisher": "0x3bf48d8d73e3cf04caabcac960026f9776b89cddb5b6865bc88a654b1b934c5c",
    "PackageId": "0x3a052925386eb45ef30a14cf75c393fab2a0ca10fbdf138987f310c956209191",
    "Whitelist": "0x785c5465137ae06615f64d19901124490f8fc926a99e0c4ead6b4e6c49af3604",
    "Digest": "5jVUWco1kHZnmjSkjhgaHJpyMWDpge1cA1e3xydnR4SF",
    "Display": "0xf3e2c6babca0eecc56702ae8bf6dc71698090c59b86232ac1c79576fba827b29"
  }
}


```


解释如下：

* `coin.packageid`：Coin 合约包的 Id。
* `coin.FaucetId`：玩家用来请求 `ENERGY` 的水龙头的 Object ID。
* `common.PackageId`：Common 合约包的 Id。
* `nft.PackageId`：NFT 合约包的 Id。
* `main.Digest`：发布 Main 包交易的摘要。
* `main.Map`：地图（map）的 Object ID。
* `common.ExperienceTable` 玩家积分（经验）等级表的 Object ID。

特别注意 `common` 中的 `ItemCreationMining`，`ItemProductionFarming`，`ItemCreationWooding`，`ItemProducitonCrafting` 属性。
这几个属性的值，是“管理员”在后台设置的用于生产制造的“生产配方”的对象 ID。

我们在下面的示例命令中，通过占位符来引用这些值：

| 技能类型 | 占位符                        | 说明                 |
|------|----------------------------|--------------------|
| 挖矿   | `{ItemCreationMining}`     | 开始挖矿进程和结束挖矿进程时使用   |
| 伐木   | `{ItemCreationWooding}`    | 开始伐木进程和结束伐木进程时使用   |
| 种棉花  | `{ItemProductionFarming}`  | 开始种植棉花进程和结束棉花进程时使用 |
| 造船   | `{ItemProducitonCrafting}` | 开始造船进程和结束造船进程时使用   |


前端可以通过链下接口查询它们的值，缓存起来使用（一般不怎么改变，可以将它们视为“准常量”）。

简单来说，你可以从链下 API 获取各种 Item（物品）的“生产配方”。对于 Creation 型的技能类型，请求这个接口：

```shell
curl -X GET "{indexer_api_base_url}/ItemCreations" -H "accept: application/json"
```

对于 Production 型的技能类型，请求这个接口：

```shell
curl -X GET "{indexer_api_base_url}/ItemProductions" -H "accept: application/json"
```


### 获取地图信息

使用以下 Sui CLI 命令可以取得地图对象的信息：

```shell
sui client object {main.map} --json
```

输出信息类似下面这样：

```JSON
{
  "objectId": "0xf36cfa34890b5f6845f538bdcb678e3822443c9b1f4f700db2a66a127d6d7162",
  "version": "37717652",
  "digest": "DwGg5Go9pTqb5fZXkmGzHKfUgDoTGDHZY8jYFRaGBQDW",
  "type": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::map::Map",
  "owner": {
    "Shared": {
      "initial_shared_version": 37712887
    }
  },
  "previousTransaction": "ErangDWTR3PgbEWDj8b7sy8Guao3No7c3ZFzt3zdioTM",
  "storageRebate": "1907600",
  "content": {
    "dataType": "moveObject",
    "type": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::map::Map",
    "hasPublicTransfer": false,
    "fields": {
      "admin_cap": "0xcc29ec9bf6e72e413f6f699a765f62c84ab028716fb4a2f1333bddb3d26c6cf1",
      "id": {
        "id": "0xf36cfa34890b5f6845f538bdcb678e3822443c9b1f4f700db2a66a127d6d7162"
      },
      "locations": {
        "type": "0x2::table::Table<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::coordinates::Coordinates, 0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::map_location::MapLocation>",
        "fields": {
          "id": {
            "id": "0xc64d10079ffcb61c167ad8793a585092939df129f7a284ee5fefebc57fc98dfe"
          },
          "size": "2"
        }
      },
      "schema_version": "0",
      "version": "3"
    }
  }
}
```

我们主要关注其中的 `content.locations`属性部分，该部分表示地图上目前已经添加的岛屿。

可以使用 curl 请求 Sui JSON RPC 接口：

```
curl -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1,"method":"suix_getDynamicFields","params":[$content.locaions.fields.id.id]}' https://fullnode.testnet.sui.io/
```

可以获得以下类似信息：

```JSON
{
    "jsonrpc": "2.0",
    "result": {
        "data": [
            {
                "name": {
                    "type": "0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::coordinates::Coordinates",
                    "value": {
                        "x": 51,
                        "y": 51
                    }
                },
                "bcsName": "9XmJiC4mP1y",
                "type": "DynamicField",
                "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::map_location::MapLocation",
                "objectId": "0x5dfb8153dfd0aeea1e1558e0b3f991cac1d8ab5e797627ad4445ce4ce099a692",
                "version": 37717652,
                "digest": "9H5nvaRUXbyULStSPsjUdDn7DXQS1nNFmVqKmRVyoMPn"
            },
            {
                "name": {
                    "type": "0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::coordinates::Coordinates",
                    "value": {
                        "x": 50,
                        "y": 50
                    }
                },
                "bcsName": "9N4dhPDnnU7",
                "type": "DynamicField",
                "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::map_location::MapLocation",
                "objectId": "0x78573cac493248eaea380c6658b839ad44c7a4e0bd0728d91b51a878edd3b16b",
                "version": 37716508,
                "digest": "BCn7aPsiJ2m935TZKXSbwozAt9U2MBzCrVtw1TVGbmJG"
            }
        ],
        "nextCursor": "0x78573cac493248eaea380c6658b839ad44c7a4e0bd0728d91b51a878edd3b16b",
        "hasNextPage": false
    },
    "id": 1
}
```

在上面的输出的例子中，地图上中存在两个岛屿，它们的坐标分别是 `(51, 51)` 和 `(50, 50)`。
对象类型为：`{main.packageId}::map_location::MapLocation`，对象 ID 分别为
`0x5dfb8153dfd0aeea1e1558e0b3f991cac1d8ab5e797627ad4445ce4ce099a692` 和 `0x78573cac493248eaea380c6658b839ad44c7a4e0bd0728d91b51a878edd3b16b`。

可以在控制台执行 Sui CLI 命令：

```
sui client object {mapLocationId} --json
```

可以得到类似以下的输出信息：

```json
{
  "objectId": "0x5dfb8153dfd0aeea1e1558e0b3f991cac1d8ab5e797627ad4445ce4ce099a692",
  "version": "37717652",
  "digest": "9H5nvaRUXbyULStSPsjUdDn7DXQS1nNFmVqKmRVyoMPn",
  "type": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::coordinates::Coordinates, 0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::map_location::MapLocation>",
  "owner": {
    "ObjectOwner": "0xc64d10079ffcb61c167ad8793a585092939df129f7a284ee5fefebc57fc98dfe"
  },
  "previousTransaction": "ErangDWTR3PgbEWDj8b7sy8Guao3No7c3ZFzt3zdioTM",
  "storageRebate": "2812000",
  "content": {
    "dataType": "moveObject",
    "type": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::coordinates::Coordinates, 0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::map_location::MapLocation>",
    "hasPublicTransfer": false,
    "fields": {
      "id": {
        "id": "0x5dfb8153dfd0aeea1e1558e0b3f991cac1d8ab5e797627ad4445ce4ce099a692"
      },
      "name": {
        "type": "0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::coordinates::Coordinates",
        "fields": {
          "x": 51,
          "y": 51
        }
      },
      "value": {
        "type": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::map_location::MapLocation",
        "fields": {
          "coordinates": {
            "type": "0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::coordinates::Coordinates",
            "fields": {
              "x": 51,
              "y": 51
            }
          },
          "gathered_at": "0",
          "occupied_by": null,
          "resources": [
            {
              "type": "0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::item_id_quantity_pair::ItemIdQuantityPair",
              "fields": {
                "item_id": 2,
                "quantity": 200
              }
            },
            {
              "type": "0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::item_id_quantity_pair::ItemIdQuantityPair",
              "fields": {
                "item_id": 2000000001,
                "quantity": 200
              }
            },
            {
              "type": "0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::item_id_quantity_pair::ItemIdQuantityPair",
              "fields": {
                "item_id": 2000000003,
                "quantity": 200
              }
            }
          ],
          "type": 0
        }
      }
    }
  }
}
```

注意 `content.value.fields` 属性。 其中 `fileds` 包含位置坐标，
`gathered_at` 表示上一次收集资源的时间，
`occupied_by`表示此岛屿目前被谁（哪个玩家）占领，
如果没有被占领则为 `null` 或不存在相应的键值对，否则为玩家 ID（Player ID），
`resouces` 为该岛屿目前所拥有的资源列表。

`resources` 中包含 `fields` 属性，其中 `item_id` 为资源 ID，
其中，`item_id` 为 2 时表示“棉花种子”（前端可以定义一个常量列表）,
`quantity` 为该资源的数量。

上面一系列的查询操作，均是在通过 Sui JSON RPC 接口读取链上的数据完成（可能比较繁琐）。

#### 使用链下查询服务（indexer）获取地图信息

我们的低代码工具生成的链下 Java 服务（indexer）包含了很多开箱即用的查询接口。
其中，包含根据 Map 的对象 Id 查询 Map 信息的接口。
可使用 curl 命令发动测试请求，如下：

```curl
curl -X GET "http://{domain.port}/api/Maps/{main.map}" -H "accept: application/json"
```

返回的地图信息类似：

```json
{
  "id": "0xf36cfa34890b5f6845f538bdcb678e3822443c9b1f4f700db2a66a127d6d7162",
  "version": 4,
  "offChainVersion": 1,
  "locations": [
    {
      "coordinates": {
        "x": 50,
        "y": 50
      },
      "type": 0,
      "occupiedBy": "0x05c6464186392942be5949947b2830a17343ce66b5bae374d3345c5a05eb1b16",
      "gatheredAt": 1716178988,
      "offChainVersion": 4,
      "mapId": "0xf36cfa34890b5f6845f538bdcb678e3822443c9b1f4f700db2a66a127d6d7162"
    },
    {
      "coordinates": {
        "x": 60,
        "y": 60
      },
      "type": 0,
      "gatheredAt": 0,
      "offChainVersion": 0,
      "mapId": "0xf36cfa34890b5f6845f538bdcb678e3822443c9b1f4f700db2a66a127d6d7162",
      "resources": [
        {
          "itemId": 2,
          "quantity": 200
        },
        {
          "itemId": 2000000003,
          "quantity": 200
        },
        {
          "itemId": 2000000001,
          "quantity": 200
        }
      ]
    }
  ]
}
```

注意 `locations`属性，该属性为数组，每一个元素均代表一个位置点（目前地图上的位置点只有岛屿）。
元素中如果包含 `occupiedBy` 属性，表示该岛屿已经被玩家占有，其值为 Player ID。
`gatheredAt` 表示该岛屿的上次资源收集时间。
`resources` 属性包含该岛屿可以被收集的资源的 Item ID 和数量（岛屿可采集的“资源”我们也抽象为 Item，即“物品”）。

如果返回的岛屿元素中不包含 `resources` 属性。这通常表示该岛屿的资源已经被玩家收集过，还没有“再生的待收集资源”。

### 创建玩家对象

使用 Sui CLI 创建玩家（Player)：

```
sui client call --package {main.PackageId} --module player_aggregate --function create --args {playerName} --gas-budget 11000000 --json
```

解释：

* 其中 `{playName}` 为玩家名称。

如果成功，得到 JSON 响应大致如下（这里只展示玩家对象的创建信息）：

```json
{
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 37846616
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::player::Player",
      "objectId": "0x08bd581011fb1018d1f8d4cac006d05f7008a16d3f3a47f867fcc679d33a74a5",
      "version": "37846616",
      "digest": "5XNGiL6DMYNoVnaXZ5yoGmE2iEkJjXbhT7EQajEGJXe9"
    }
```

其中 `objectId` 即为新创建的玩家对象的 ID。
在后面的测试中，需要用到玩家对象 ID 的地方，我们使用占位符 `{playerId}` 来表示。

### 查询玩家信息

可以使用 curl 命令查询指定钱包地址所拥有的玩家对象：

```shell
curl -X GET "http://{domin:port}/api/Players?owner={owner}" -H "accept: application/json"
```

其中 `{owner}` 为指定钱包地址。

可以获得如下格式的输出：

```json
[
    {
        "id": "0x05c6464186392942be5949947b2830a17343ce66b5bae374d3345c5a05eb1b16",
        "owner": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
        "level": 2,
        "experience": 105,
        "name": "John",
        "claimedIsland": {
            "x": 50,
            "y": 50
        },
        "version": 1,
        "offChainVersion": 1,
        "inventory": [
            {
                "itemId": 2000000001,
                "quantity": 199
            },
            {
                "itemId": 102,
                "quantity": 105
            },
            {
                "itemId": 2000000003,
                "quantity": 199
            }
        ]
    }
]
```

返回数据为 JSON 数组，如果数组为空，表示该钱包未拥有任何玩家，需要先创建一个玩家。
如果该数组不为空，表示该钱包地址下拥有的玩家对象（前端开发时需要尽量避免为一个钱包地址创建多个玩家对象，这样会增加开发的复杂性），
数组的元素的各属性解释如下：

* `id`：玩家对象的 ID。
* `owner`：玩家对象所属的钱包地址。
* `level`：玩家等级。
* `experience`：积分（“经验值”，这个名称从原型阶段就开始使用了，暂不作修改）。
* `name`：玩家的名字。
* `claimedIsland`：玩家所占领的岛屿的坐标。
* `inventory`：玩家目前拥有的物品（包括“资源”）库存，其中数组元素的 `item_id` 属性为物品（资源）的 ID，`quantity`： 为库存数量。
  库存在进行生产活动时（种植，挖矿，伐木，造船等）时会减少或增加（原材料 item 数量会减少，产出结果 item 数量会增加）。

---

### 关于玩家的技能进程

可以将技能进程（Skill Process）理解为制造物品（Item）的“生产线”。

玩家在占领一个岛屿之后，目前合约会为之自动创建 4 类 5 条这样的“生产线”。其中农业（种植）技能有 2 条“生产线”，其他技能各有 1 条。

注意，我们在下文的示例命令会使用一些占位符来引用“当前玩家”的技能进程对象 ID：

| 技能类型             | 技能类型常量值 | “生产线”编号 | 示例命令使用的技能进程对象 ID 占位符     |
|------------------|---------|---------|--------------------------|
| 种植 (Farming)     | 0       | 0       | `{SkillProcessFarming1}` |
| 种植 (Farming)     | 0       | 1       | `{SkillProcessFarming2}` |
| 伐木 (WoodCutting) | 1       | 0       | `{SkillProcessWooding}`  |
| 挖矿 (Mining)      | 3       | 0       | `{SkillProcessMining}`   |
| 造船 (Crafting)    | 6       | 0       | `{SkillProcessCrafting}` |

---

### 占领（Claim）岛屿

用户在创建玩家（Player）对象之后，可以对无人占领的岛屿进行占领（Claim）。

使用 Sui CLI 执行占领：

```shell
sui client call --package {main.PackageId} \
--module player_aggregate \
--function claim_island \
--args {playerId} \
{main.Map} \
{coordinates_x} \
{coordinates_y} \
{clock} \
{main.RosterTable} \
{main.SkillProcessTable} 
--gas-budget 4999000000 --json
```

解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{playerId}`：类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{main.map}`：类型为 `&mut Map`。CLI 中可传入地图对象的 ID。在 Main 合约包发布的时候，自动执行的初始化函数会创建地图对象。
* `{coordinates_x}`：类型为 `u32`。Claim 的岛屿的 X 坐标值。
* `{coordinates_y}`：类型为 `u32`。Claim 的岛屿的 Y 坐标值。
* `{clock}`：类型为 `&Clockr`。时钟对象的 ID。Sui 的时间对象 ID 是个固定值：`0x6`。
* `{main.RosterTable}`: 类型为 `&mut RosterTable`。Main 合约发布时初始化的一个 Table 对象的 ID。该 Table 中包含了包含所有的船队的“索引信息”。包含“玩家”以及“环境”船队。该 Table 的 Key 是“玩家 ID + 船队序号 `[0-4]`”的组合。
* `{main.SkillProcessTable}`： 类型为 ` &mut SkillProcessTable`。Main 合约发布时初始化的一个 Table 对象的 ID。该 Table 包含所有技能流程（可以理解使用技能的“生产线”）的“索引信息”。
  这里的技能包括 Farming、WoodCutting、Mining、 Crafting。该 Table 的 Key 为“玩家 ID + SkillTypeId”的组合。

执行成功后返回内容节选重要部分如下：

```json
{
  "digest": "B46Tg4tuvrazHvqnkH29V5Haie9RHYqKLyHs9aciFJqG",
  "objectChanges": [
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::roster::Roster",
      "objectId": "0x02d20edd0c5766b4919e7ba07a1f746b32a6c80b3db9efa11788ea16810fb089",
      "version": "38211112",
      "digest": "GXZs2Zs8122DyNzHMPPGatRBaFScKezt8rHGi8SNqBdt"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xc36ee5a398f9848b35c0a6d62bb37ab10ecc68256d0fd44d5bea5f57a41e98d4"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::roster_id::RosterId, 0x2::object::ID>",
      "objectId": "0x04c1fb0e3af31cbe59f965e541ffe65e040ed302929531548f39da27df5821d0",
      "version": "38211112",
      "digest": "CuLGgN7HJFpiNh7nfVTuzjN4KEbHCZKqgEwRGeQ179jt"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xc36ee5a398f9848b35c0a6d62bb37ab10ecc68256d0fd44d5bea5f57a41e98d4"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::roster_id::RosterId, 0x2::object::ID>",
      "objectId": "0x09b967f3212fc396f855847d76bf06cdf41e6f6948c7a62729f01cce69c1f47e",
      "version": "38211112",
      "digest": "FtEXZQtV2MYAC4YTe3BoAjfVUxqV3LynvPjjdJVTKyt"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xc36ee5a398f9848b35c0a6d62bb37ab10ecc68256d0fd44d5bea5f57a41e98d4"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::roster_id::RosterId, 0x2::object::ID>",
      "objectId": "0x1859a93305fb450b9f788aa57cf1ae0c340266e57dad249da13e079a6c58a4aa",
      "version": "38211112",
      "digest": "H81ZQr4cT7D7z5HBpS2fBKgRMSCnXyjaQvNxSpcnJok4"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xb24e3d045a031d342c8dced3950f015684c21f2da5d77a012004e10864a23bd7"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::skill_process_id::SkillProcessId, 0x2::object::ID>",
      "objectId": "0x197ce1ce90645064b35132163f2355b2ca44d10e3694d1cf3890fa78e35001a1",
      "version": "38211112",
      "digest": "3unfu1sDB6Y3WmtFGBTLm1uS2bbVw5Kd3sft4T8dpTSz"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xb24e3d045a031d342c8dced3950f015684c21f2da5d77a012004e10864a23bd7"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::skill_process_id::SkillProcessId, 0x2::object::ID>",
      "objectId": "0x1d70b9d3f5b4b6bed1b43da07efd18355b1e12cbdfbe84bca18dbc85b15f44c6",
      "version": "38211112",
      "digest": "CxmMZqrQKT6sDVEM8AjfA3VPezQKpB4idM6KZFtsskDy"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::roster::Roster",
      "objectId": "0x244b6ed71ee283fd92c2004889a04462415227fb73e7aab7cf8cd99967de2541",
      "version": "38211112",
      "digest": "DD2ALt8yxHRmyhMNZ8oYJjFTc8LMCCxK8tDM2DJwxEG2"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::roster::Roster",
      "objectId": "0x3e69224c0b59c663f7a918efdeb2afb011b5dbddecc49f3bf4b4c0b4ba498a16",
      "version": "38211112",
      "digest": "BiMdYs6yKUBP7HpR91xeCRNg5XbiV5soGXtGvFrBRUcK"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xb24e3d045a031d342c8dced3950f015684c21f2da5d77a012004e10864a23bd7"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::skill_process_id::SkillProcessId, 0x2::object::ID>",
      "objectId": "0x46d1d9d3f3f818124f0b34870ca3f0c0c8631160829e317949b417afaeecb5c6",
      "version": "38211112",
      "digest": "D9RnLQxsumHt2JCZDFERJBptX9HHvK5Lb83eN2PFBAbw"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::skill_process::SkillProcess",
      "objectId": "0x4f902c9fc5b792792e757a791182e5bbe2c12684d02796d01e34758709670c97",
      "version": "38211112",
      "digest": "BJqA8Z3TFTc3RLvgoRbdVq8ymtW7AF6HPNS2LdqTRXs2"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xb24e3d045a031d342c8dced3950f015684c21f2da5d77a012004e10864a23bd7"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::skill_process_id::SkillProcessId, 0x2::object::ID>",
      "objectId": "0x65d7fe5a48eaf4ab32780db1e1bf286689095f7b28428cbfe20e6ad669a18dfb",
      "version": "38211112",
      "digest": "FuFv6KNUsmD8RbRKCZ6grUJcqcTEdKLkazgpjgh2vCHh"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::roster::Roster",
      "objectId": "0x7fa10794b24d2c2abda8626cfd894700dc2fe504cbbfa80bb4f37862aebdf562",
      "version": "38211112",
      "digest": "EFNwseqmecrtiq6b2eTtgR4BQJTuy26Xk2v4g2uJUWLw"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xc36ee5a398f9848b35c0a6d62bb37ab10ecc68256d0fd44d5bea5f57a41e98d4"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::roster_id::RosterId, 0x2::object::ID>",
      "objectId": "0x8459e00114dcdc965dacbf9bff002827c771a75c97f0f8636219ac07ce1ee7cf",
      "version": "38211112",
      "digest": "DosuYbLzGqsKrBbp56MkbsiriXDMNsrXASghpoPCZA2k"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::roster::Roster",
      "objectId": "0x8efcc4aa7c04df85a042fb537a041068211374c67204b5f29a58ead0693a302a",
      "version": "38211112",
      "digest": "rqsBuu7qMXQPBTnmnetmZSaaa5NobucCfBMaXV3u3bL"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xb24e3d045a031d342c8dced3950f015684c21f2da5d77a012004e10864a23bd7"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::skill_process_id::SkillProcessId, 0x2::object::ID>",
      "objectId": "0x9b7b21e42e48b254720c40cbf96d78fde0e90fcf41fa44d9f575e2dd418a33e5",
      "version": "38211112",
      "digest": "H4XcSjApqTj6i1PsfyJwExs7a3AwP2y9BJQ6JSJC833D"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0xc36ee5a398f9848b35c0a6d62bb37ab10ecc68256d0fd44d5bea5f57a41e98d4"
      },
      "objectType": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::roster_id::RosterId, 0x2::object::ID>",
      "objectId": "0x9ceea46de035cb467288325a1d51a782cedb53dae9e9a48f82c700c1d3489ce0",
      "version": "38211112",
      "digest": "C3ErjMt9PWt3oneiAxLyWT4kMJeZeZuTiEwQ6KusRzuZ"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::skill_process::SkillProcess",
      "objectId": "0xad00bf5bec692c71f9b765471cbca3149519b29e0436a89753006e99a1f0ca5f",
      "version": "38211112",
      "digest": "GTjHuUVGZwYrz1GCjQQL7Ztbma4zmL3TsW41ST6q7JpG"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::skill_process::SkillProcess",
      "objectId": "0xb67c787d2eafb523e0aee3bfaf2f42174cd9e088df7958c1b09cfd276b6578b3",
      "version": "38211112",
      "digest": "3jK4itwTA9gQU5YFEY2XA5xkge2CyDR9BmmcNujZ7oXu"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::skill_process::SkillProcess",
      "objectId": "0xc9acdba2a7b06e103064ba566643d0074dd689ceee03a306707e5e4345b476a8",
      "version": "38211112",
      "digest": "HndKvSZrgS42JSRib6PxDVib4XDB9oH8LzQqVwFDDnmC"
    },
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 38211112
        }
      },
      "objectType": "0x1f1267f7197c3f118b5d1f147a9ceb9296318f786842ab743715f0645fda30dc::skill_process::SkillProcess",
      "objectId": "0xd8831b89fd4157aaf58b60eef3a7f437c429373a35d18177ae1660baffee2f95",
      "version": "38211112",
      "digest": "7HhHHHddK6h3LxEpz6Tn5Sg1gWgtDHXdvq5jHNvTZ7QC"
    }
  ]
}
```

其中：

* 类型为 `{main.PackageId}::roster::Roster` 的元素，为玩家的船队信息。目前玩家在占领岛屿时，合约会创建 5 个船队对象。元素中的 `objectId` 属性为船队的对象 Id。
* 类型为 `0x2::dynamic_field::Field<{common.PackageId}::roster_id::RosterId, 0x2::object::ID>` 对象，
  是一个“保存船队信息的 Table”的“动态字段”子对象。
  通过这个对象，可以查询到船队的 ID 信息（参考下文关于如何查询 Move Table 的内容的介绍）。我们下面将船队的对象 ID 使用占位符 `{RosterObjectId}` 表示。
* 类型为 `{main.PackageId}::skill_process::SkillProcess` 的元素，该元素为玩家的“技能进程”对象。目前占领岛屿时，会创建 5 个这样的对象。
* 类型为 `0x2::dynamic_field::Field<{common.PackageId}::skill_process_id::SkillProcessId, 0x2::object::ID>` 的对象，是一个“保存技能进程信息的 Table”的“动态字段”子对象。
  这个对象的 ID 我们使用占位符 `{SkillProcess_dynamic_field_ObjectId}` 表示。
  通过这个对象，可以查询到技能进程的 ID 信息（参考下文关于如何查询 Move Table 的内容的介绍）。

#### 查询玩家的船队

使用 Sui CLI 命令可以取得某一个船队的信息：

```shell
sui client object {RosterObjectId} --json
```

输出信息类似下面这样：

```json
{
  "objectId": "0x8b1fe8c0bae52a1eccd9dcd0d3b5dbc081549950e6b3326ff6fd9c75bb09861b",
  "version": "38222489",
  "digest": "FvUvdSzCyqmP19QxmzsoxvzAuKeSFmPEoHGMv6sDUDcZ",
  "type": "0x8d4b0f3b3be41e525ec63e252f14b52e149ead9b2904f55a8b3878044999b56b::roster::Roster",
  "owner": {
    "Shared": {
      "initial_shared_version": 38222489
    }
  },
  "previousTransaction": "D1xCRt3k13KSmpDQGpL8GJcEh2pUf9erMzCm1vURjfco",
  "storageRebate": "2462400",
  "content": {
    "dataType": "moveObject",
    "type": "0x8d4b0f3b3be41e525ec63e252f14b52e149ead9b2904f55a8b3878044999b56b::roster::Roster",
    "hasPublicTransfer": false,
    "fields": {
      "admin_cap": "0x5ca182644b2013ed1fbdcc7af8ea5f75a17244af587d10ea6a442666f3dbeb69",
      "base_experience": null,
      "coordinates_updated_at": "0",
      "energy_vault": "0",
      "environment_owned": false,
      "id": {
        "id": "0x8b1fe8c0bae52a1eccd9dcd0d3b5dbc081549950e6b3326ff6fd9c75bb09861b"
      },
      "roster_id": {
        "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::roster_id::RosterId",
        "fields": {
          "player_id": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
          "sequence_number": 1
        }
      },
      "schema_version": "0",
      "ship_battle_id": null,
      "ship_ids": [],
      "ships": {
        "type": "0x2::object_table::ObjectTable<0x2::object::ID, 0x8d4b0f3b3be41e525ec63e252f14b52e149ead9b2904f55a8b3878044999b56b::ship::Ship>",
        "fields": {
          "id": {
            "id": "0x05967ae35658e974c23dd2e6d64b3831ce03e1e8740b7635c61323fdc8cd89c2"
          },
          "size": "0"
        }
      },
      "speed": 0,
      "status": 0,
      "target_coordinates": null,
      "updated_coordinates": {
        "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::coordinates::Coordinates",
        "fields": {
          "x": 50,
          "y": 50
        }
      },
      "version": "0"
    }
  }
}
```

注意其中的 `content.fields.roster_id` 属性。
可以看到其 `type` 为 `{common.PackageId}::roster_id::RosterId`，
其中的 `fields` 属性包括 `player_id` 和 `sequence_number`；
`player_id` 为玩家的 ID，`sequence_number` 为船队编号。

每个玩家有 5 个船队，编号依次为 0，1，2，3，4。
其中 0 号船队有特殊含义，表示 “Unassigned Roster”。
当玩家造船进程执行成功，得到的船只会默认被加入到该船队。

上面的查询结果中，新创建的船队对象中不包含船只信息。
当玩家将船只移入该船队后，将呈现更多的属性。

#### 查询玩家技能进程

执行 Sui CLI 命令：

```shell
sui client object {SkillProcess_dynamic_field_ObjectId} --json
```

得到下面类似的输出信息：

```json
{
  "objectId": "0x197ce1ce90645064b35132163f2355b2ca44d10e3694d1cf3890fa78e35001a1",
  "version": "38211112",
  "digest": "3unfu1sDB6Y3WmtFGBTLm1uS2bbVw5Kd3sft4T8dpTSz",
  "type": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::skill_process_id::SkillProcessId, 0x2::object::ID>",
  "owner": {
    "ObjectOwner": "0xb24e3d045a031d342c8dced3950f015684c21f2da5d77a012004e10864a23bd7"
  },
  "previousTransaction": "B46Tg4tuvrazHvqnkH29V5Haie9RHYqKLyHs9aciFJqG",
  "storageRebate": "2667600",
  "content": {
    "dataType": "moveObject",
    "type": "0x2::dynamic_field::Field<0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::skill_process_id::SkillProcessId, 0x2::object::ID>",
    "hasPublicTransfer": false,
    "fields": {
      "id": {
        "id": "0x197ce1ce90645064b35132163f2355b2ca44d10e3694d1cf3890fa78e35001a1"
      },
      "name": {
        "type": "0x2b853e8306950ffdabe20df1ae5703c27dfb909d53099558113251f8a0d0a596::skill_process_id::SkillProcessId",
        "fields": {
          "player_id": "0xc68695161ec629a13e5e749f08207436aa6b47ce1b66c1f0ff63f77d1cce7228",
          "sequence_number": 0,
          "skill_type": 0
        }
      },
      "value": "0xb67c787d2eafb523e0aee3bfaf2f42174cd9e088df7958c1b09cfd276b6578b3"
    }
  }
}
```

其中 `content.fields.name.fields` 的三个属性：

* `player_id`：玩家对象 ID。
* `skill_type`：技能类型。
* `sequence_number`：“生产线”的编号。

而 `content.fields.value` 为“生产线”对象的 ID。

依次查询前一步得到的 5 个 `{SkillProcess_dynamic_field_ObjectId}`，可以获取上面 4 类 5 条“生产线”的对象 ID。
我们下面的示例命令使用占位符引用它们（关于这些占位符的定义，见前文）。

通过 Sui JSON RPC 查询玩家的船队信息或技能进程信息，过程略显繁琐。
我们的链下查询服务（indexer）提供了更便捷的接口。

### 通过 indexer 查询玩家的船队及技能进程

#### 通过 indexer 查询玩家的船队

使用 curl 命令获取指定玩家的船队信息：

```shell
curl -X GET "http://yangjiefeng.natapp1.cc:80/api/Rosters?rosterId.playerId={playerId}" \
-H "accept: application/json"
```

输出信息类似下面这样：

```json
[
    {
        "rosterId": {
            "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
            "sequenceNumber": 0
        },
        "id_": "0x4d92b147c3f3d11dda09709e21a9362735bc0e773bb39b0d161f5ecd9f2a3bff",
        "status": 0,
        "speed": 4,
        "ships": {
            "id": "0xde8410c83dd8827bbd039f41cccdb40be523db31546f29ab065a0944e8a274a0",
            "size": 1
        },
        "updatedCoordinates": {
            "x": 50,
            "y": 50
        },
        "coordinatesUpdatedAt": 0,
        "environmentOwned": false,
        "energyVault": 0,
        "version": 9,
        "offChainVersion": 9,
        "rosterShipsItems": [
            {
                "key": "0x17f835a304db4c0cc106e35f194d4f8c658a2ede0f00ca9f01b7878c7d5586cd",
                "value": {
                    "owner": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "building_expenses": {
                        "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pairs::ItemIdQuantityPairs",
                        "fields": {
                            "items": [
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 102,
                                        "quantity": 4
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 200,
                                        "quantity": 4
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 301,
                                        "quantity": 7
                                    }
                                }
                            ]
                        }
                    },
                    "attack": 5,
                    "protection": 4,
                    "id": {
                        "id": "0x17f835a304db4c0cc106e35f194d4f8c658a2ede0f00ca9f01b7878c7d5586cd"
                    },
                    "health_points": 20,
                    "version": "0",
                    "speed": 4
                },
                "offChainVersion": 0,
                "rosterId": {
                    "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "sequenceNumber": 0
                }
            }
        ],
        "shipIds": [
            "0x17f835a304db4c0cc106e35f194d4f8c658a2ede0f00ca9f01b7878c7d5586cd"
        ]
    },
    {
        "rosterId": {
            "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
            "sequenceNumber": 1
        },
        "id_": "0x8b1fe8c0bae52a1eccd9dcd0d3b5dbc081549950e6b3326ff6fd9c75bb09861b",
        "status": 0,
        "speed": 0,
        "ships": {
            "id": "0x05967ae35658e974c23dd2e6d64b3831ce03e1e8740b7635c61323fdc8cd89c2",
            "size": 0
        },
        "updatedCoordinates": {
            "x": 50,
            "y": 50
        },
        "coordinatesUpdatedAt": 0,
        "environmentOwned": false,
        "energyVault": 0,
        "version": 0,
        "offChainVersion": 0
    },
    {
        "rosterId": {
            "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
            "sequenceNumber": 2
        },
        "id_": "0x1a66c3613c83e7e88c3e9ee111306f8327a5b6f9ec6f1361b07588c26fcaca65",
        "status": 0,
        "speed": 0,
        "ships": {
            "id": "0xee0f09701ce72eafe2c4943a6a0edf65ac6cc8b00d805cee1ddffa55a5959533",
            "size": 0
        },
        "updatedCoordinates": {
            "x": 50,
            "y": 50
        },
        "coordinatesUpdatedAt": 0,
        "environmentOwned": false,
        "energyVault": 0,
        "version": 0,
        "offChainVersion": 0
    },
    {
        "rosterId": {
            "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
            "sequenceNumber": 3
        },
        "id_": "0x302126a4537c8189d8d94cc45e4127c8c7069dfa352de9195588a741870dfdcc",
        "status": 0,
        "speed": 0,
        "ships": {
            "id": "0xe61990569be23b7325ec8d418445c14f4173a7cfea1ac62b42a7439cba0b068f",
            "size": 0
        },
        "updatedCoordinates": {
            "x": 50,
            "y": 50
        },
        "coordinatesUpdatedAt": 0,
        "environmentOwned": false,
        "energyVault": 0,
        "version": 0,
        "offChainVersion": 0
    },
    {
        "rosterId": {
            "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
            "sequenceNumber": 4
        },
        "id_": "0xb490508e29aebda93bb90868f1bb9d455810785d8eda48b5c72e3b05012387a3",
        "status": 0,
        "speed": 4,
        "ships": {
            "id": "0x20a0743fe4a541e1ea9483035758273b1d3dc02627c675ea19bd5ba4a1df95de",
            "size": 4
        },
        "updatedCoordinates": {
            "x": 50,
            "y": 50
        },
        "coordinatesUpdatedAt": 0,
        "environmentOwned": false,
        "energyVault": 0,
        "version": 0,
        "offChainVersion": 0,
        "rosterShipsItems": [
            {
                "key": "0xe80a2fbcb21a9a2b318b30bf478fef5ef0c35e542460f0432d6470ee6c3e1eb6",
                "value": {
                    "owner": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "building_expenses": {
                        "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pairs::ItemIdQuantityPairs",
                        "fields": {
                            "items": [
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 102,
                                        "quantity": 4
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 200,
                                        "quantity": 5
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 301,
                                        "quantity": 6
                                    }
                                }
                            ]
                        }
                    },
                    "attack": 5,
                    "protection": 5,
                    "id": {
                        "id": "0xe80a2fbcb21a9a2b318b30bf478fef5ef0c35e542460f0432d6470ee6c3e1eb6"
                    },
                    "health_points": 20,
                    "version": "0",
                    "speed": 4
                },
                "offChainVersion": 0,
                "rosterId": {
                    "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "sequenceNumber": 4
                }
            },
            {
                "key": "0x273bd00b0df174f6595fcd5f6e8dbe8344a38a5f6aa4516e0002b49def8c39c4",
                "value": {
                    "owner": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "building_expenses": {
                        "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pairs::ItemIdQuantityPairs",
                        "fields": {
                            "items": [
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 102,
                                        "quantity": 6
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 200,
                                        "quantity": 5
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 301,
                                        "quantity": 4
                                    }
                                }
                            ]
                        }
                    },
                    "attack": 4,
                    "protection": 5,
                    "id": {
                        "id": "0x273bd00b0df174f6595fcd5f6e8dbe8344a38a5f6aa4516e0002b49def8c39c4"
                    },
                    "health_points": 20,
                    "version": "0",
                    "speed": 5
                },
                "offChainVersion": 0,
                "rosterId": {
                    "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "sequenceNumber": 4
                }
            },
            {
                "key": "0x80dc17e475a259cde1a114689d110f8aa109e0bcabcf85b4876371ebc813f744",
                "value": {
                    "owner": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "building_expenses": {
                        "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pairs::ItemIdQuantityPairs",
                        "fields": {
                            "items": [
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 102,
                                        "quantity": 6
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 200,
                                        "quantity": 4
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 301,
                                        "quantity": 5
                                    }
                                }
                            ]
                        }
                    },
                    "attack": 5,
                    "protection": 4,
                    "id": {
                        "id": "0x80dc17e475a259cde1a114689d110f8aa109e0bcabcf85b4876371ebc813f744"
                    },
                    "health_points": 20,
                    "version": "0",
                    "speed": 5
                },
                "offChainVersion": 0,
                "rosterId": {
                    "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "sequenceNumber": 4
                }
            },
            {
                "key": "0xdf17c004d47be86384895044a4df3325928a82706733e7a1562ab3ecd46957cf",
                "value": {
                    "owner": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "building_expenses": {
                        "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pairs::ItemIdQuantityPairs",
                        "fields": {
                            "items": [
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 102,
                                        "quantity": 5
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 200,
                                        "quantity": 6
                                    }
                                },
                                {
                                    "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::item_id_quantity_pair::ItemIdQuantityPair",
                                    "fields": {
                                        "item_id": 301,
                                        "quantity": 4
                                    }
                                }
                            ]
                        }
                    },
                    "attack": 4,
                    "protection": 5,
                    "id": {
                        "id": "0xdf17c004d47be86384895044a4df3325928a82706733e7a1562ab3ecd46957cf"
                    },
                    "health_points": 20,
                    "version": "0",
                    "speed": 5
                },
                "offChainVersion": 0,
                "rosterId": {
                    "playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
                    "sequenceNumber": 4
                }
            }
        ],
        "shipIds": [
            "0xe80a2fbcb21a9a2b318b30bf478fef5ef0c35e542460f0432d6470ee6c3e1eb6",
            "0x273bd00b0df174f6595fcd5f6e8dbe8344a38a5f6aa4516e0002b49def8c39c4",
            "0x80dc17e475a259cde1a114689d110f8aa109e0bcabcf85b4876371ebc813f744",
            "0xdf17c004d47be86384895044a4df3325928a82706733e7a1562ab3ecd46957cf"
        ]
    }
]
```

返回的数据为 JSON 数组，数组内的每个元素代表一个船队。
船队元素包含的属性：

* `rosterId`： 为船队的业务主键 ID。
  其下的属性 `playerId ` 为船队所属玩家 ID，
  `sequenceNumber` 为该船队的编号。
* `id_`： 为 Sui 的船队 Move 对象 ID（`{RosterObjectId}`）。
* `status`： 为船队的状态。0：停泊中，1：行进中，2：战斗中，3：已损毁。
* `speed`： 为船队的速度。
* `updatedCoordinates`： 船队最后一次更新的位置坐标。
* `environmentOwned`： 是否是“环境”船队。（用于 PvE。）
* `coordinatesUpdatedAt`： 船队位置坐标的最后更新时间。
* `shipIds`： 该船队包含的船只 ID 的列表。
* `rosterShipsItems`： 该船队包含的船只对象信息的列表。

注意船队的 `rosterShipsItems` 属性，该属性为 JSON 数组。
其中的数组元素主要包含以下属性：

* `key` 为船只的对象 ID。
* `attack` 为该船只的攻击值。
* `protection` 为该船只的防御值。
* `speed` 为船只的速度。
* `health_points` 为该船只的健康值。
* `value` 包含了该船只的建造原料信息。
* `value.building_expenses.fields.items` 是该船只的建造原料列表。
* `value.building_expenses.fields.items.fields.item_id` 建造原料的 Item ID。
* `value.building_expenses.fields.items.fields.quantity` 建造原料的数量。

#### 通过 indexer 查询玩家的技能进程

使用 curl 命令可以取得指定玩家的船队信息：

```shell
curl -X GET "http://localhost:1023/api/SkillProcesses?skillProcessId.playerId=0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291" -H "accept: application/json"
```

输出信息类似下面这样：

```json
[{
	"skillProcessId": {
		"skillType": 0,
		"playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
		"sequenceNumber": 0
	},
	"id_": "0x3a2b5e7b36111f2fb9f6423c6c2ef5a5cba73f441af6fec0cb616ee37698356b",
	"itemId": 102,
	"startedAt": 1716278816,
	"creationTime": 5,
	"completed": true,
	"endedAt": 1716278829,
	"energyVault": 5,
	"batchSize": 1,
	"version": 2,
	"offChainVersion": 0
}, {
	"skillProcessId": {
		"skillType": 0,
		"playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
		"sequenceNumber": 1
	},
	"id_": "0xb70e54cfca7a3f6fa68bc616e761a47789f6013e51aa2d616f61e5e10982bbab",
	"itemId": 0,
	"startedAt": 0,
	"creationTime": 0,
	"completed": true,
	"endedAt": 0,
	"energyVault": 0,
	"batchSize": 1,
	"version": 0,
	"offChainVersion": 0
}, {
	"skillProcessId": {
		"skillType": 1,
		"playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
		"sequenceNumber": 0
	},
	"id_": "0x9ced723bd1cd3a36aa7b778c6596f1ebf0182fd3f65c9e4144bfe623f7c7909b",
	"itemId": 200,
	"startedAt": 1716278848,
	"creationTime": 3,
	"completed": true,
	"endedAt": 1716278861,
	"energyVault": 5,
	"batchSize": 1,
	"version": 2,
	"offChainVersion": 0
}, {
	"skillProcessId": {
		"skillType": 3,
		"playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
		"sequenceNumber": 0
	},
	"id_": "0xbd0d065237b2b11136c9d2f3d88cdc8909e1869a7ab44bf0398d373571701629",
	"itemId": 301,
	"startedAt": 1716278781,
	"creationTime": 3,
	"completed": true,
	"endedAt": 1716278798,
	"energyVault": 1,
	"batchSize": 1,
	"version": 2,
	"offChainVersion": 0
}, {
	"skillProcessId": {
		"skillType": 6,
		"playerId": "0xf07a26fe8ad373a65bca4c99aab65c2872b29156e0c6a677af01edf23058a291",
		"sequenceNumber": 0
	},
	"id_": "0xf9c94a70f9fe017e5f3e9cba022d3b82b48382f3b8581fe1e48b1256885bc6b3",
	"itemId": 1000000001,
	"startedAt": 1716279939,
	"creationTime": 3,
	"completed": true,
	"endedAt": 1716280103,
	"energyVault": 50,
	"productionMaterials": {
		"items": [{
			"itemId": 102,
			"quantity": 4
		}, {
			"itemId": 200,
			"quantity": 4
		}, {
			"itemId": 301,
			"quantity": 7
		}]
	},
	"batchSize": 1,
	"version": 10,
	"offChainVersion": 2
}]
```

返回的数据是一个 JSON 数组，数组中的每个元素都表示一个技能进程（“生产线”）。
元素包含的属性：

* `skillProcessId` 为技能进程的业务主键 ID。
  其中 `skillType` 表示技能类型，
  `playerId` 为玩家对象 ID，
  `sequenceNumber` 为该技能的“生产线”序列号。
  目前，除了农业（farming）有 0 和 1，其他技能这里都是 0。
* `itemId` 为该技能进程的产出成品的 Item ID。
* `id_` 为技能进程的 Sui Move 对象 ID。
* `startedAt` 技能进程的最后一次启动时间。这是一个以秒数计算的 Unix 时间。
* `completed` 最后一次“生产”是否已完成。
  如果完成，可以开始下一次生产；
  如果没有完成，但是“时间已到”，那么前端可以调用相应的 complete 方法来获取制造结果，
  并更新“生产线”的状态。
* `endedAt` 最后一次“生产”的结束时间。
* `energyVault` 消耗能量币的数量。
* `batchSize` 本批次的数量，即按照“生产配方”投产的“份数”。
  “生产配方”定义的原材料和产出成品的数量都是“一份”的数量。

### ~~【Old】申请 ENERGY（on testnet）~~

~~玩家在生产制造以及航行时都需要花费 `ENERGY` 代币。
在测试网上，玩家可以使用以下 Sui CLI 命令申请 `ENERGY` 代币：~~

```shell
sui client call --package  {coin.PackageId} --module energy_faucet --function request_a_drop --args {coin.FaucetId} --json
```

参数解释：

* {main.PackageId}：Coin 合约包的 ID。
* {coin.FaucetId}：类型为 `&mut EnergyFaucet`。CLI 中可传入 `ENERGY` 的水龙头对象 ID。

该命令成功执行后，可获得以下类似输出：
```json
{
  "digest": "23QgAnoCRm5eFxBc3eHGURW6My6VsUD2gGTUB7d9p8UQ",
  "effects": {
    "messageVersion": "v1",
    "status": {
      "status": "success"
    }
  },
  "objectChanges": [   
    {
      "type": "created",
      "sender": "0x18c9efc771fb402058703ec5842981e515dcc3bcf8c4ce05f1a4bc5f50d1a32b",
      "owner": {
        "AddressOwner": "0x18c9efc771fb402058703ec5842981e515dcc3bcf8c4ce05f1a4bc5f50d1a32b"
      },
      "objectType": "0x2::coin::Coin<0x9582e95e1507ae556aa3f708d19c48a5d65446d8c5cbf15b3ebed26eae6a8c87::energy::ENERGY>",
      "objectId": "0x4acc392e33950370418c9c0aed0a3a2bc346f667e41fe3b227433a934b7777c9",
      "version": "43412199",
      "digest": "3Dee2vt3V1HKfkf2KMBG5uzSSnhj2agcPz8U9u1Y8Wgm"
    }
  ],
  "balanceChanges": [
    {
      "owner": {
        "AddressOwner": "0x18c9efc771fb402058703ec5842981e515dcc3bcf8c4ce05f1a4bc5f50d1a32b"
      },
      "coinType": "0x9582e95e1507ae556aa3f708d19c48a5d65446d8c5cbf15b3ebed26eae6a8c87::energy::ENERGY",
      "amount": "100000000000"
    }
  ],
  "confirmedLocalExecution": true
}
```

在属性 `objectChanges` 中可以看到对象类型 `objectType` 为 `0x2::coin::Coin<{coin.PackageId}::energy::ENERGY>` 的对象，   
在属性 `balanceChanges` 中可以看到货币类型 `coinType` 为 `{coin.PackageId}::energy::ENERGY` 和数量 `amount` 为 `100000000000` 的对象。



### 【New】申请 ENERGY（on testnet）

玩家在生产制造以及航行时都需要花费 `ENERGY` 代币。
在测试网上，玩家可以使用以下 Sui CLI 命令申请 `ENERGY` 代币：

```shell
sui client call --package  {faucet.PackageId} --module energy_faucet --function request_a_drop --args {faucet.EnergyFaucet} {clock} --json
```

参数解释：

* {faucet.PackageId}：`faucet 合约包的 ID。
* {faucet.EnergyFaucet}：类型为 `&mut EnergyFaucet`。CLI 中可传入 `ENERGY` 的水龙头对象 ID。
* {clock}: 类型为 `&Clock`。时钟对象的 ID，固定值：`0x6`。

该命令成功执行后，可获得以下类似输出：
```json
{
  "digest": "kn1XpHHKX6xLHbTVA1FHgWktqfQZuy5i5G6UrJdAPAr",
  "effects": {
    "messageVersion": "v1",
    "status": {
      "status": "success"
    }
  },
  "objectChanges": [
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "AddressOwner": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450"
      },
      "objectType": "0x2::coin::Coin<0xcbf5a847697e587a3b51552f292bd840a1b188cd4709a871246a187fb3ea25b7::energy::ENERGY>",
      "objectId": "0xe5738b1d69e3b24675336ff23f45b8ef059e49037e9c463b4335d54a19422379",
      "version": "76860353",
      "digest": "3NaLfuTyszT86H19LS4hD8m2gfj6vdCzx44m4K2KN7sx"
    }
  ],
  "balanceChanges": [
    {
      "owner": {
        "AddressOwner": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450"
      },
      "coinType": "0xcbf5a847697e587a3b51552f292bd840a1b188cd4709a871246a187fb3ea25b7::energy::ENERGY",
      "amount": "50000000000"
    }
  ],
  "confirmedLocalExecution": true
}
```

在属性 `objectChanges` 中可以看到对象类型 `objectType` 为 `0x2::coin::Coin<{faucet.PackageId}::energy::ENERGY>` 的对象，   
在属性 `balanceChanges` 中可以看到货币类型 `coinType` 为 `{faucet.PackageId}::energy::ENERGY` 和数量 `amount` 为 `50000000000` 的对象。


### 查询 `ENERGY`余额

玩家可以通过以下 `curl` 命令获取指定账户中的 `ENERGY` 余额：

```shell
curl -X POST \
-H "Content-Type: application/json" \
-d '{"jsonrpc":"2.0","id":1,"method":"suix_getCoins","params":["{accountAddress}","{coin.PackageId}::energy::ENERGY"]' https://fullnode.testnet.sui.io/
```

参数解释：

* `{accountAddress}`：类型为 `address`。玩家的 `Sui` 账户地址。
* `{faucet.PackageId}`: Faucet 合约包 ID。

可以获取以下格式的输出：

```json
{
  "jsonrpc": "2.0",
  "result": {
    "data": [{
      "coinType": "0x9582e95e1507ae556aa3f708d19c48a5d65446d8c5cbf15b3ebed26eae6a8c87::energy::ENERGY",
      "coinObjectId": "0x4acc392e33950370418c9c0aed0a3a2bc346f667e41fe3b227433a934b7777c9",
      "version": "43412199",
      "digest": "3Dee2vt3V1HKfkf2KMBG5uzSSnhj2agcPz8U9u1Y8Wgm",
      "balance": "100000000000",
      "previousTransaction": "23QgAnoCRm5eFxBc3eHGURW6My6VsUD2gGTUB7d9p8UQ"
    }, {
      "coinType": "0x9582e95e1507ae556aa3f708d19c48a5d65446d8c5cbf15b3ebed26eae6a8c87::energy::ENERGY",
      "coinObjectId": "0x6fb61f92a8a1e9215c9bfee2771353b95751d6a65677144af5fd489f68c74f54",
      "version": "43412198",
      "digest": "mBgH9LBehuzBAPLTxoXNHztNuNTdwMh6xRgVk3J4c4m",
      "balance": "100000000000",
      "previousTransaction": "DaYqN2zKr65WBETvpHcFamWCAzk5hte2goRGbVmkoQiS"
    }],
    "nextCursor": "0x6fb61f92a8a1e9215c9bfee2771353b95751d6a65677144af5fd489f68c74f54",
    "hasNextPage": false
  },
  "id": 1
}
```

属性 `result.data` 是包含货币类型（`coinType`） 为 `{coin.PackageId}::energy::ENERGY` 的对象数组。  
数组中 `coinObjectId` 为账户中的货币对象 ID，可以作为开始“生产制造”的输入参数。  
`balance` 之和即为账户 `{accountAddress}` 的 `ENERGY` 余额。

### 查询玩家上一次申请 ENERGY 的时间

#### 1、查询水龙头对象
执行以下 Sui CLI 命令查询水龙头对象：
```shell
sui client object {faucet.EnergyFaucet} --json
```
以上命令的输出结果类似如下：
```json
{
  "objectId": "0x8e07d6bc0f4cc87c346324d8f76d8bc5318e646bc37395819587480544198157",
  "version": "79108175",
  "digest": "2eoLkj5M87vNKfwEbpRfAhN7ySMH21uaGi5UNYJvZhH1",
  "type": "0x42e44326b9815f5b3833912d3124e8e006ce8110798bd159c04a1ed6bee4a326::energy_faucet::EnergyFaucet",
  "owner": {
    "Shared": {
      "initial_shared_version": 77043852
    }
  },
  "previousTransaction": "C8865K9aHctdYJSY4f299YbmYgTQuhKCcfQJo4P9pmoa",
  "storageRebate": "1748000",
  "content": {
    "dataType": "moveObject",
    "type": "0x42e44326b9815f5b3833912d3124e8e006ce8110798bd159c04a1ed6bee4a326::energy_faucet::EnergyFaucet",
    "hasPublicTransfer": true,
    "fields": {
      "balance": "299950000000000",
      "grant_records": {
        "type": "0x2::table::Table<address, 0x42e44326b9815f5b3833912d3124e8e006ce8110798bd159c04a1ed6bee4a326::energy_faucet::GrantRecord>",
        "fields": {
          "id": {
            "id": "0xce07ede120db7c87544f6c825acdc7050566cade1ea827c684c2846b136b8a45"
          },
          "size": "1"
        }
      },
      "id": {
        "id": "0x8e07d6bc0f4cc87c346324d8f76d8bc5318e646bc37395819587480544198157"
      }
    }
  }
}
```
注意元素 `grant_records`， 可以看到 `type` 属性的值为 `0x2::table::Table<address, {faucet.PackageId}::energy_faucet::GrantRecord>`，
我们将其 `fields.id.id` 属性的值记录为 `{filedId}`；
#### 2、查询动态字段
执行以下 Sui CLI 命令：
```shell
curl -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1,"method":"suix_getDynamicFields","params":["{fieldId}}"]}' https://fullnode.testnet.sui.io/
```
将得到以下输出信息：
```json
{
  "jsonrpc": "2.0",
  "result": {
    "data": [{
      "name": {
        "type": "address",
        "value": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450"
      },
      "bcsName": "AeSDpp9vwabkg8UaSLAykn7F9HbvHWhSzmB5DuNRjtgX",
      "type": "DynamicField",
      "objectType": "0x42e44326b9815f5b3833912d3124e8e006ce8110798bd159c04a1ed6bee4a326::energy_faucet::GrantRecord",
      "objectId": "0x9e65d7cebceb90870b397e3bfa6a3c71ec4c903032077af5109ca64c2d2164be",
      "version": 79108175,
      "digest": "J8c5WngFFJN7RuWcpmARrbrE3ZF8K5aQ8WS7XvkQAdfr"
    }],
    "nextCursor": "0x9e65d7cebceb90870b397e3bfa6a3c71ec4c903032077af5109ca64c2d2164be",
    "hasNextPage": false
  },
  "id": 1
}
```
可以看到 `result.data` 元素是个数组，对于其中的每一个元素来说：
* 其 `objectType` 属性的值为 `{faucet.PackageId}.::energy_faucet::GrantRecord`; 
* 其 `name`元素的`type` 为 `address`，`value` 为从水龙头申请 `ENERGY` 的玩家地址;
* 其 `objectId` 属性的值就是上述玩家地址上次申请 `ENERGY` 时保存的相关信息。
 
选择与查询的玩家地址匹配的记录中的 `objectId`，保存为 `{GrantRecordId}`。
当然如果玩家没有从水龙头申请过`ENERGY`，不会在此保存记录。

#### 查询 `GrantRecord`
```shell
sui client object {GrantRecordId} --json
```
以上命令的输出结果类似如下：
```json
{
  "objectId": "0x9e65d7cebceb90870b397e3bfa6a3c71ec4c903032077af5109ca64c2d2164be",
  "version": "79108175",
  "digest": "J8c5WngFFJN7RuWcpmARrbrE3ZF8K5aQ8WS7XvkQAdfr",
  "type": "0x2::dynamic_field::Field<address, 0x42e44326b9815f5b3833912d3124e8e006ce8110798bd159c04a1ed6bee4a326::energy_faucet::GrantRecord>",
  "owner": {
    "ObjectOwner": "0xce07ede120db7c87544f6c825acdc7050566cade1ea827c684c2846b136b8a45"
  },
  "previousTransaction": "C8865K9aHctdYJSY4f299YbmYgTQuhKCcfQJo4P9pmoa",
  "storageRebate": "2158400",
  "content": {
    "dataType": "moveObject",
    "type": "0x2::dynamic_field::Field<address, 0x42e44326b9815f5b3833912d3124e8e006ce8110798bd159c04a1ed6bee4a326::energy_faucet::GrantRecord>",
    "hasPublicTransfer": false,
    "fields": {
      "id": {
        "id": "0x9e65d7cebceb90870b397e3bfa6a3c71ec4c903032077af5109ca64c2d2164be"
      },
      "name": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "value": {
        "type": "0x42e44326b9815f5b3833912d3124e8e006ce8110798bd159c04a1ed6bee4a326::energy_faucet::GrantRecord",
        "fields": {
          "amount": "50000000000",
          "grantedAt": "1720872579239"
        }
      }
    }
  }
}
```
我们将目光聚焦在 `conent.value` 元素，我们将发现其 `type`属性为 `{faucet.PackageId}::energy_faucet::GrantRecord`。
对于其 `fields`属性：

* `amount` 的值为上一次从水龙头申请得到的 `ENERGY` 的数量；
* `grantedAt` 的值为上一次申请的时间。




### 开始挖矿流程

玩家进行挖矿流程时，需要执行“开始挖矿流程”命令：

执行如下 Sui CLI 开始挖矿：

```shell
sui client call --package {main.PackageId} \
--module skill_process_service --function start_creation \
--args {SkillProcessMining} \
{batchSize} \
{playerId} \
{common.ItemCreationMining} \
{clock} \
{energyId} \
--gas-budget 11000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{SkillProcessMining}`：类型为 `&mut SkillProcess`。CLI 中可传入挖矿进程 Move 对象 ID，参考前文中的技能进程占位符。
* `{batchSize}`：类型为 `u32`。本批次的数量，即按照“生产配方”投产的“份数”。 “生产配方”定义的原材料和产出成品的数量都是“一份”的数量。
* `{playerId}`：类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{common.ItemCreationMining}`：类型为 `&ItemCreation`。CLI 中可传入挖矿配方对象 ID。
* `{clock}`：类型为 `&Clock`。时钟对象的 ID，固定值：`0x6`。
* `{eneryId}`：类型为 `Balance<ENERGY>`。CLI 中可传入能量币（`ENERGY`）的 Object ID。

每一种生产制造进程都需要经历一定的时间，比如挖“一份”矿需要 3 秒钟，那么开始一次“挖矿”进程后，结合本次挖矿批次数量 ` batchSize`，则在经历  `batchSize` * 3 秒钟后，需要执行对应的“完成挖矿进程”来结束挖矿进程。

在技能进程成功开始后，会扣除玩家相应的原材料资源。

### 结束挖矿流程

开始挖矿进程并经过所需时间之后，需执行“结束挖矿进程”来完成挖矿。

执行如下 Sui CLI 来结束挖矿：

```shell
sui client call --package {main.PackageId} \
--module skill_process_aggregate \
--function complete_creation \
--args {SkillProcessMiningId} \
{playerId} \
{common.itemCreationMining} \
{common.experienceTableId} \
{clock} \
 --gas-budget 42000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{SkillProcessMining}`：类型为 `&mut SkillProcess`。CLI 中可传入挖矿进程 Move 对象 ID，参考前文中的技能进程占位符。
* `{playerId}`：类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{common.ItemCreationMining}`：类型为 `&ItemCreation`。CLI 中可传入挖矿配方对象 ID。
* `{common.experienceTableId}`：类型为 `&ExperienceTable`。CLI 中可传入玩家积分（经验）等级表格对象 ID。
* `{clock}`：类型为 ` &Clockr`。时钟对象 ID，固定值：`0x6`。

在成功结束技能进程之后，玩家的对应产出成果的资源数量会增加。

### 开始伐木进程

除将参数 `{SkillProcessMining}`  更改为 `{SkillProcessWooding}`，

将参数 `{common.ItemCreationMining}` 更改为 `{common.ItemCreationWooding}` 之外，

其余参数与上述“开始挖矿进程”相同，这里不再赘述。

### 结束伐木进程

除将参数 `{SkillProcessMining}`  更改为 `{SkillProcessWooding}`，

将参数 `{common.ItemCreationMining}` 更改为 `{common.ItemCreationWooding}` 之外，

其余参数与上述“结束挖矿进程”相同，这里不再赘述。

### 开始种植棉花进程

种植棉花进程有两条“生产线”，对应的技能进程对象 ID 分别为 `{SkillProcessFarming1}` 和 `{SkillProcessFarming2}`。

对于种植棉花这项技能来说，玩家可以同时开启两条“生产线”。

我们以开启种植棉花的第一条“生产线”举例，执行以下 Sui CLI 命令：

```shell
sui client call --package {main.PackageId} \
--module skill_process_service \
--function start_production \
--args {SkillProcessFarming1} \
{batchSize} \
{playerId} \
{common.ItemProductionFarming} \
{clock} \
{energyId} \
--gas-budget 11000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{SkillProcessFarming1}`：类型为 `&mut SkillProcess`。CLI 中可传入为种植棉花第一条“生产线”的 Move 对象 ID；
  `{SkillProcessFarming2}`：为第二条“生产线”的 Move 对象 ID。
* `batchSize`：类型为 `u32`。本批次的数量，即按照“生产配方”投产的“份数”。 “生产配方”定义的原材料和产出成品的数量都是“一份”的数量。
* `{playerId}`：类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{common.ItemProductionFarming}`：类型为 `&ItemProduction`。CLI 中可传入种植棉花的“配方”的 Sui Move 对象 ID。
* `{clock}`：类型为 `&Clock`。时钟对象 ID，固定值：0x6。
* `{eneryId}`：类型为 `Balance<ENERGY>`。CLI 中可传入能量币（`ENERGY`）的 Object ID。

### 结束种植棉花进程

结束种植棉花过程应该在达到完成种植进程所需时间之后。

玩家要结束“种植棉花”进程，需要执行以下 Sui CLI 命令：

```shell
sui client call --package {main.PackageId} \
--module skill_process_aggregate \
--function complete_production \
--args {SkillProcessFarming1} \
{playerId} \
{common.ItemProductionFarming} \
{common.ExperienceTable} \
{clock} \
--gas-budget 42000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{SkillProcessFarming1}`：  类型为 `&mut SkillProcess`。CLI 中可传入种植棉花第一条“生产线”的 Move 对象 ID；`{SkillProcessFarming2}` 为第二条“生产线”的 Move 对象 ID。
* `{playerId}`： 类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{common.ItemProductionFarming}`： 类型为 `&ItemProduction`。CLI 中可传入种植棉花配方 Move 对象 ID。
* `{common.ExperienceTable}：` 类型为 ` &ExperienceTable`。CLI 中可传入玩家积分（经验）等级表格对象 ID。
* `{clock}`： 类型为 `&Clock`。结束种植棉花进程时间，固定值：0x6。

### 开始造船进程

玩家在占领岛屿后，可以造船并管理自己的船队。

如果想要造船，可以执行以下 Sui CLI 命令开启造船流程：

```shell
sui client call --package {main.PackageId} \
--module skill_process_service \
--function start_ship_production \
--args  {SkillProcessCrafting} \
{production_materials_item_id_list} \
{production_materials_item_quantity_list} \
{playerId} \
{common.ItemProductionCrafting} \
{clock} \
{EnergyId} \
--gas-budget 42000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{SkillProcessCrafting}`：类型为 `&mut SkillProcess`。CLI 中可传入造船技能的 Move 对象 ID。
* `{production_materials_item_id_list}`：类型为 `vector<u32>`。造船所需的资源的 Item ID 的数组。Testnet 上的当前值（“准常量”）：`[200,301,102]`。
* `{production_materials_item_quantity_list}`：类型为 `vector<u32>`。造船投入的资源数量的数组，与 `production_materials_item_id_list` 中的 Item ID 一一对应。
  如：`[4,5,6]`，当前 testnet 合约要求每种资源数量最少 3，总数量为 15。在此限制下，具体每种资源投入的数量由玩家指定。
* `{playerId}`：类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{common.ItemProductionCrafting}`： 类型为 `&ItemProduction`。CLI 中可传入造船配方 Move 对象 ID。
* `{clock}`：类型为 `&Clock`。CLI 中可传入固定值：0x6。
* `{energyId}`： 类型为 `Balance<ENERGY>`。CLI 中可传入能量币（`ENERGY`）的 Object ID。

### 结束造船进程

经过所需的造船时间之后，需要调用下面的 Sui CLI 命令来结束造船进程。

```shell
sui client call --package {main.PackageId} \
--module skill_process_aggregate \
--function complete_ship_production \
--args  {SkillProcessCrafting} \
{rosterId} \
{playerId}  \
{ItemProductionCrafting} \
{common.ExperienceTable} \
{clock}  \
--gas-budget 42000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{SkillProcessCrafting}`： 类型为 `&mut SkillProcess`。CLI 中可传入玩家造船技能的 Move 对象 ID。
* `{rosterId}`：类型为 `&mut Roster`。CLI 中可传入序号为 0 的船队 Move 对象 ID，即前文中提到的有特殊含义容纳“Unassigned Ships”的船队 。
* `{playerId}`： 类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{common.ItemProductionCrafting}`： 类型为 `&ItemProduction`。CLI 中可传入造船配方 Move 对象 ID。
* `{common.ExperienceTable}`： 类型为 `&ExperienceTable`。CLI 中可传入玩家积分（经验）等级表格对象 ID。
* `{clock}`： 类型为 `&Clock`。CLI 中可传入固定值：0x6。

执行成功之后，可以看到类似下面的输出：

```json
{
  "digest": "9XbgftdrKy6njbgkGHtXEG9Wj2LJY4QWguHccNmKv2Eq",  
  "objectChanges": [
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "ObjectOwner": "0x710951e97963ae9567887249e001e8c67639f9ba3572829a36ce2c147530539f"
      },
      "objectType": "0xe32d611dfe833b8586b03e9502e46fb35a16e161a38c84d6074644e4251ab929::ship::Ship",
      "objectId": "0x3531b5f3fb0633ee9cff7d5b411a1849f4a7227ebc345a135300b809b925ff59",
      "version": "34681290",
      "digest": "BGQiyfSUcMbVNHdf96ha91r1W7z9Kn8M5jXdHUw7KB4q"
    }
  ]
}
```

类型（`objectType`）为 `{main.packageId}::ship::Ship` 的元素的对象 ID（`objectId`）即为新得到的船只的对象 ID。

### 向船队添加船只

每个玩家有 5 支船队，编号为 0-4 ，其中编号为 0 的船队为 "unassigned roster"，玩家新建的船只先加入该船队。
编号 1-4 的船队，每支船队可以容纳 4 艘船。向这些船队中添加船只时，可以执行以下 Sui CLI 命令：

```shell
sui client call --package {main.PackageId} \
--module roster_aggregate \
--function transfer_ship \
--args  {sourceRoster} \
{playerId} \
{shipId}  \
{targetRoster} \
{targetPosition} \
 --gas-budget 42000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{sourceRoster}`：类型为 `&mut Roster`。CLI 中可传入编号为 0 的船队 Move 对象 ID。
* `{playerId}`： 类型为 `&Player`。CLI 中可传入玩家对象 ID。
* `{shipId}`：类型为 `ID`。CLI 中可传入被添加船只的对象 ID。
* `{targetRoster}`： 类型为 `&mut Roster`。CLI 中可传入目标船队的对象 ID。必须是编号 1-4 的船队对象 ID 之一。
* `{targetPosition}`： 类型为 `Option<u64>`。表示将船只添加到目标船队的位置，格式 `[{Number}]`。 `{Number}`的取值范围为 0-3 或者空。如果为空，也就是`[]`，表示将船只添加到船队末尾位置。

### 从船队中“取消”船只

可以将编号 1-4 的船队中的指定船只取消，被取消的船只自动回到编号为 0 的“unassigned roster”船队。

船队“添加船只”和“取消船只”是同一个接口。

通过以下 Sui CLI 命令执行取消命令：

```shell
sui client call --package {main.PackageId} \
--module roster_aggregate \
--function transfer_ship \
--args  {sourceRoster} \
{playerId} \
{shipId}  \
{targetRoster} \
{targetPosition} \
 --gas-budget 42000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{sourceRoster}`：类型为 `&mut Roster`。CLI 中可传入编号为 1-4 的玩家船队的 Move 对象 ID。
* `{playerId}`： 类型为 `&Player`。CLI 中可传入玩家对象 ID。
* `{shipId}`：类型为 `ID`。CLI 中可传入被取消船只的对象 ID。
* `{targetRoster}`： 类型为 `&mut Roster`。CLI 中可传入编号为 0 的玩家船队的 Move 对象 ID。
* `{targetPosition}`： 类型为 `Option<u64>`。CLI 中传入直接传入值 `[]`。意为将取消船只置于“unassigned roster”船队的末尾。

### 调整船只顺序

玩家可以调整船只在船队中的顺序。

通过执行以下 Sui CLI 命令来确定船队中所有船只的最终顺序：

```shell
sui client call --package {main.PackageId} \
--module roster_aggregate \
--function adjust_ships_position \
--args {rosteId} \
{playerId} \
{positions} \
{shipIds}  \
--gas-budget 4999000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包的 ID。
* `{rosteId}`：类型为 `&mut Roster`。CLI 中可传入船队对象 ID。
* `{playerId}`： 类型为 `&Player`。CLI 中可传入玩家对象 ID。
* `{positions}`：类型为 `vector<u64>`。船只的位置数组。注意 `shipIds` 和 `positions` 数组的长度必须相等。
* `{shipIds}`： 类型为 `vector<ID>`。变更顺序的船只的 ID 的数组。

该合约函数的执行逻辑是依次执行由参数 `shipIds` 和 `positions` 组成的“船只位置调整指令”。
为了确保调整的正确性，最简单的做法是，将船队所有位置的船只按照顺序传入 `shipIds` 和 `positions` 数组。

### 船队航行

通过以下 Sui CLI 命令将指定船队移动到指定位置。

```shell
sui client call --package {main.PackageId} \
--module roster_service \
--function set_sail \
--args {roster} \
{playerId} \
{target_coordinates_x} \
{target_coordinates_y} \
{clock} \
{energyId} \
{energy_amount} \
--gas-budget 11000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包 ID。
* `{roste}`：类型为 `&mut Roster`。CLI 中可传入船队对象 ID。
* `{playerId}`： 类型为 `&palyer`。CLI 中可传入玩家对象 ID。
* `{target_coordinates_x}`：类型为 `u32`。航行目的地的横坐标。
* `{target_coordinates_y}`：类型为 `u32`。航行目的地的纵坐标，。
* `{clock}`：类型为 `&Clock`。时钟对象 ID，固定值 `0x6`。
* `{energyId}`：类型为 `Coin<ENERGY>`。CLI 中可传入能量币（`ENERGY`）的 Object ID。
* `{energy_amount}`：类型为 `u64`。本次航行需要花费能量币（`ENERGY`）数量。

### 更新船队位置

船队出发后，如果想知道船队在地图上的最新位置，可以通过执行以下的 Sui CLI 命令来实现：

```shell
sui client call --package {main.PackageId} \
--module roster_aggregate \
--function update_location \
--args {rosteId} \
{clock} \
--gas-budget 1000000 --json
```

* `{main.PackageId}`：Main 合约包 ID。
* `{roste}`：类型为 `&mut Roster`。CLI 中可传入船队对象 ID。
* `{clock}`：类型为 `&Clock`。 时钟对象 ID，固定值 `0x6`。

执行以上命令之后，可以通过以下 Sui CLI 命令来查看船队信息：

```shell
sui client object {roster}--json
```

其中 `{roster}` 为船队对象ID。

以上命令可以得到如下类似输出信息：

```json
{
  "objectId": "0xb490508e29aebda93bb90868f1bb9d455810785d8eda48b5c72e3b05012387a3",

  "content": {
    "dataType": "moveObject",
    "type": "0x8d4b0f3b3be41e525ec63e252f14b52e149ead9b2904f55a8b3878044999b56b::roster::Roster",
    "hasPublicTransfer": false,
    "fields": {

      "ship_ids": [
        "0x273bd00b0df174f6595fcd5f6e8dbe8344a38a5f6aa4516e0002b49def8c39c4",
        "0xe80a2fbcb21a9a2b318b30bf478fef5ef0c35e542460f0432d6470ee6c3e1eb6",
        "0xdf17c004d47be86384895044a4df3325928a82706733e7a1562ab3ecd46957cf",
        "0x80dc17e475a259cde1a114689d110f8aa109e0bcabcf85b4876371ebc813f744"
      ],

      "speed": 4,
      "status": 1,
      "target_coordinates": {
        "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::coordinates::Coordinates",
        "fields": {
          "x": 500,
          "y": 500
        }
      },
      "updated_coordinates": {
        "type": "0x9e1f56b7299081e61f81ba261fe333e98cb59a866dcf90e0c00df21180c96487::coordinates::Coordinates",
        "fields": {
          "x": 307,
          "y": 307
        }
      },
      "version": "17"
    }
  }
}
```

在 `content.fields` 属性中可以看到以下几个重要属性：

* `target_coordinates`：船队的航行目的地。
  其 `fields` 为目的地坐标。
* `updated_coordinates`：最后一次更新船队位置后的坐标信息。
  其 `fields` 为最后一次更新时坐标。
* `status` 为船队的状态。0：停泊中，1：行进中，2：战斗中，3：已损毁。

### 资源转移

目前有三种资源转移方式：同船队船与船之间、船与岛屿之间（从船转移到岛屿和从岛屿转移到船）。

#### 船与船之间资源转移

只有同一船队的船只之间才可以进行资源转移，可以通过以下的 Sui CLI 命令实现：

```shell
sui client call --package {main.packageId} \
--module roster_aggregate \
--function transfer_ship_inventory \
--args {roster} \
{player} \
{fromShipId} \
{toShipId} \
{itemIds} \
{quantities} \
 --gas-budget 11000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包 ID。
* `{roste}`：类型为 `&mut Roster`。CLI 中可传入船队对象 ID。
* `{player}`：类型为 `&Player`。 CLI 中可传入玩家对象 ID。
* `{fromShipId}`：类型为 `ID`。CLI 中可传入转移资源船只对象 ID。
* `{toShipId}`： 类型为 `ID`。CLI 中可传入接收资源船只对象 ID。
* `{itemIds}`： 类型为 `vector<u32>`。转移资源（Item）的 ID 的数组。
  如：`[102,200,301]`，表示要转移 Item ID 为 102、200、301 的三种资源。
* `{quantities}`：类型为 `vector<u32>`。转移资源（Item）的数量数组。
  如：`[38,11,23]`，结合上面的 `itemIds`，用以表示以上三种资源各自转移数量。

注意：对象 ID 为 `{fromShipId}` 和 `{toShipId}` 的船只均属于对象 ID 为 `{roste}` 的同一船队。

#### 从船转移资源到岛屿

停泊在玩家自家岛屿附近的自家船只上的资源可以转移到自家岛屿，通过以下的 Sui CLI 命令实现：

```shell
sui client call --package {main.packageId} \
--module roster_aggregate \
--function take_out_ship_inventory \
--args {roster} \
{playerId} \
{clock} \
{shipId} \
{itemIds} \
{quantities} \
 --gas-budget 11000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包 ID。
* `{roste}`：类型为 `&mut Roster`。CLI 中可传入船队对象 ID。
* `{playerId}`： 类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{clock}`：类型为 `&Clock`。时钟对象 ID，CLI 中可传入固定值：0x6。
* `{shipId}`：类型为 `ID`。CLI 中可传入转移资源船只对象 ID。
* `{itemIds}`： 类型为 `vector<u32>`。转移资源（Item）的 ID 的数组。
  如：`[102,200,301]`，表示要转移 Item ID 为 102、200、301 的三种资源。
* `{quantities}`：类型为 `vector<u32>`。转移资源（Item）的数量数组。
  如：`[38,11,23]`，结合上面的 `itemIds`，用以表示以上三种资源各自转移数量。

#### 从岛屿转移资源到船

同样玩家可以将自家岛屿上的资源转移到停泊在附近的自家船只上，通过以下的 Sui CLI 命令实现：

```shell
sui client call --package {main.packageId} \
--module roster_aggregate \
--function put_in_ship_inventory \
--args {roster} \
{playerId} \
{clock} \
{shipId} \
{itemIds} \
{quantities} \
 --gas-budget 11000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包 ID。
* `{roste}`：类型为 `&mut Roster`。CLI 中可传入船队对象 ID。
* `{playerId}`： 类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{clock}`：类型为 `&Clock`。CLI 中可传入固定值：0x6。
* `{shipId}`：类型为 `ID`。CLI 中可传入转移资源船只对象 ID。
* `{itemIds}`： 类型为 `vector<u32>`。转移资源（Item）的 ID 的数组。
  如：`[2,200,301]`，表示要转移 Item ID 为 2、200、301 的三种资源。
* `{quantities}`：类型为 `vector<u32>`。转移资源（Item）的数量数组。
  如：`[38,11,23]`，结合上面的 `itemIds`，用以表示以上三种资源各自转移数量。

### 战斗

玩家可以控制己方一只船队对其他玩家的船队或者环境船队发动进攻，进而发生战斗。

玩家选择“自动进攻”时，系统需执行以下 Sui CLI 命令：

```shell
sui client call --package {main.packageId} \
--module ship_battle_service \
--function initiate_battle_and_auto_play_till_end \
--args {playerId} \
{initiator} \
{responder} \
{clock} \
--gas-budget 4999000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包 ID。
* `{playerId}`： 类型为 `&mut Player`。CLI 中可传入玩家对象 ID。
* `{initiator}`： 类型为 `&mut Roster`。CLI 中可传入发起战斗作为挑战船队的对象 ID。
* `{responder}`： 类型为 `&mut Roster`。CLI 中可传入遭到攻击作为应战船队的对象 ID。
* `{clock}`：类型为 `&Clock`。CLI 中可传入固定值：0x6。

战斗结束后，在返回的输出中，包含类似的内容：

```Json
{

  "objectChanges": [
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": "@{Shared=}",
      "objectType": "0xaee83076475d11960108b6f4cb6e06b489397f17d22da8a7a0deb18354c16750::ship_battle::ShipBattle",
      "objectId": "0x8cd018a1657ac59e9262873c967456bcb5a5cdfbaf5cf988dd75ea60cc715c4c",
      "version": "35636581",
      "digest": "Bu1roPeH4FA9M2vyagND9MCWZKMb1HMVn5uo9hym3p8k"
    }
  ]
  
}
```

我们记录类型（objectType）为 `ship_battle::ShipBattle` 的对象的 Move 对象 ID（objectId）的值为占位符 `{ShipBattleId}`，
用来表示本次战斗的唯一标识，通过该对象 ID，我们可以查看关于战斗的更多信息。

### 查看战斗信息

执行以下 Sui CLI 命令可以查看某次战斗的详细信息：

```shell
sui client object {shipBattleId} --json
```

参数解释：

* `{ShipBattleId}` 表示战斗的唯一标识。

以上命令会得到以下类似输出信息：

```json
{
  "objectId": "0x8cd018a1657ac59e9262873c967456bcb5a5cdfbaf5cf988dd75ea60cc715c4c",
  "version": "35636638",
  "digest": "CQkXm88LHAvmJ6nF6GXfyA1VN3AqyY1uD6j7y62SxsLP",
  "type": "0xaee83076475d11960108b6f4cb6e06b489397f17d22da8a7a0deb18354c16750::ship_battle::ShipBattle",
  "owner": {
    "Shared": {
      "initial_shared_version": 35636581
    }
  },
  "previousTransaction": "FqiT1LWMkpJeseQJU7caZgKTsAWAurMegifYCCtSK7Vz",
  "storageRebate": "2272400",
  "content": {
    "dataType": "moveObject",
    "type": "0xaee83076475d11960108b6f4cb6e06b489397f17d22da8a7a0deb18354c16750::ship_battle::ShipBattle",
    "hasPublicTransfer": false,
    "fields": {
      "ended_at": "1715825128",
      "id": {
        "id": "0x8cd018a1657ac59e9262873c967456bcb5a5cdfbaf5cf988dd75ea60cc715c4c"
      },
      "initiator": "0x3dfb3f2ef35684c86a82095a46332146038ef75afc1bff4a16ec2d98a9fc8e11",
      "initiator_experiences": [
        3,
        3,
        3,
        3
      ],
      "responder": "0x7634886a12806eaeed4698f7a5034bfc5adb56b7055853e06d9c80130b2cc8cb",
      "responder_experiences": [
        8
      ],
      "round_attacker_ship": null,
      "round_defender_ship": null,
      "round_mover": null,
      "round_number": 45,
      "round_started_at": "1715825128",
      "status": 2,
      "version": "46",
      "winner": 1
    }
  }
}
```

我们重点关注 `content.fields` 属性，其中又包含了以下重要属性：

* `ended_at` ：表示战斗结束时间，是一个以秒为计算单位的 UNIX 时间值。
* `initiator` ：发起战斗的船队对象 ID。
* `responder` ：应战船队对象 ID。
* `round_number` ：战斗回合数。
* `status`：战斗状态。0：进行中，1：已结束，2：已清理。
* `winner`：表示获胜方是谁。1：挑战方获胜，0：应战方获胜。

### 收集战利品

如果玩家赢得了战斗，玩家可以决定在战后清理中是否搜索对方船队并收集战利品。

如果对方是环境船队并且赢得了战斗，那么由系统进行战斗后清理工作。

执行以下 Sui CLI 命令进行战后清理工作：

```shell
sui client call --package {main.packageId} \
--module ship_battle_aggregate \
--function take_loot \
--args {ShipBattleId}\
{playerId} \
{losterPlayerId} \
{initiator} \
{responder} \
{common.ExperienceTable} \
{clock} \
{choice} \
--gas-budget 4999000000 --json
```

参数解释：

* `{main.PackageId}`：Main 合约包 ID。
* `{ShipBattleId}`： 类型为 `&mut ShipBattle`。CLI 中可传入战斗对象 ID。
* `{playerId}`： 类型为 `&mut Player`。CLI 中可传入战斗发起方玩家对象 ID。
* `{loser_player}`： 类型为 `&mut Player`。CLI 中可传入战斗应战方玩家对象 ID。
* `{initiator}`： 类型为 `&mut Roster`。CLI 中可传入发起战斗作为挑战船队的对象 ID。
* `{responder}`： 类型为 `&mut Roster`。CLI 中可传入遭到攻击作为应战船队的对象 ID。
* `{common.ExperienceTable}`：类型为 `&ExperienceTable`。CLI 中可传入玩家积分（经验）等级表格对象 ID。
* `{clock}`：类型为 `&Clock`。CLI 中可传入固定值：0x6。
* `{choice}`： 类型为 `u8`。获胜方对战利品的行动选择，1: 接受, 0: 放弃。


### Mint NFT(PFP)

持有 `NTF` 包发布对象 `Publisher` 的管理者，可以给入围用户打造 NFT(PFP)。

执行以下 Sui CLI 命令进行 Mint：

Execute the `Sui CLI` command for Mint:

```shell
sui client call --package {nft.packageId} \
--module avatar_aggregate \
--function mint \
--args {publisherId}\
{owner} \
{name} \
{image_url} \
{description} \
{background_color} \
{race} \
{eyes} \
{mouth} \
{haircut} \
{skin} \
{outfit} \
{accessories} \
{aura} \
{symbols} \
{effects} \
{backgrounds} \
{decorations} \
{badges} \
--json
```

参数解释：

Input parameter description:

* `{nft.PackageId}`：NFT 合约包 ID（NFT Contract Package ID）。
* `{publisherId}`： 类型为 `&sui::package::Publisher`。合约包发布者对象 ID（Contract package publisher object ID）。
* `{owner}`： 类型为 `address`。入围用户账号地址（Address of user）。
* `{image_url}`： 类型为 `String`。NFT 头像图片 URL（NFT image URL）。
* `{description}`： 类型为 `String`。头像描述信息（NFT description）。
* `{background_color}`： 类型为 `u32`。背景颜色(Background color)。
* `{race}`：类型为 `u8`。种族类别(Race)。
* `{eyes}`：类型为 `u8`。眼睛(Eyes)。
* `{mouth}`：类型为 `u8`。嘴巴(Mouth)。
* `{haircut}`：类型为 `u8`。发型(Haircut)。
* `{skin}`：类型为 `u8`。皮肤(Skin)。
* `{outfit}`：类型为 `u8`。搭配(Outfit)。
* `{accessories}`：类型为 `u8`。配饰(Accessory)。
* `{aura}`：类型为 `vector<u8>`。光晕数组(Aura vector)。
* `{symbols}`：类型为 `vector<u8>`。符号数组(Symbol vector)。
* `{effects}`：类型为 `vector<u8>`。作用影响效果数组(effect vector)。
* `{backgrounds}`：类型为 `vector<u8>`。背景数组(Background vector)。
* `{decorations}`：类型为 `vector<u8>`。装饰数组(Decoration vector)。
* `{badges}`：类型为 `vector<u8>`。徽章数组(Badge vector)。


执行成功，将得到如下相似的 JSON 格式输出结果（部分）：

After successful command execution, you will receive an output with a JSON structure similar to the following:

```json
{
  "objectChanges": [    
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "AddressOwner": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450"
      },
      "objectType": "0xfb136fbf0c9bf27cf71938835155928092240f537c5e84f67084fefb268e253d::avatar::Avatar",
      "objectId": "0xc9998bf99612c61be7c23620a969049047f93a7d2ef3ef69aa37cfe7c3139f95",
      "version": "51055253",
      "digest": "7VBF57Tvr4AMFvYGCQxZCsCnAjxhX77WfD8Jrp4MfezZ"
    }
  ]
}
```
其中 `objectId` 即为给用户打造的 NFT 对象之 ID。后面测试中需要使用 NFT 对象 ID 的地方，将使用占位符 `{avatarId}` 来引用它。

Among them, 'objectId' is the ID of the NFT object created for the user. In future tests, where NFT object IDs are required, placeholders ` {avatarId} ` will be used to reference it.

### 创建 NFT 变更信息（Create AvatarChange Object）

`NFT(PFP)` 会因为很多因素而变化，比如每天登录并玩游戏，推广游戏等等。

每当玩家的动作对 `NFT(PFP)` 中的属性值造成变化时，如果与玩家 `NFT(PFP)` 对象对应的 `AvatarChange` 对象不存在，前端应为其创建一个 `AvatarChange` 对象，
如果已经存在那么修改 `AvatarChange` 对象，然后使用它更新 `NFT(PFP)` 对象。

前端通过检查玩家是否拥有 `{nft.packageId}.avatar_change.AvatarChange` 结构类型的对象来判断是创建还是更新对应的 AvatarChange 对象。

如果玩家的 `NFT(PFP)` 对象不存在对应的 `AvatarChange` 对象，那么可以通过执行如下 `Sui CLI` 命令来创建：


Create an `AvatarChange` object by executing the following `Sui CLI` command:

```shell
sui client call --package {nft.packageId} --module avatar_change_aggregate --function create --args \
{avatarId} \
{nft.Publisher} \
{image_url} \
{background_color} \
{haircut} \
{outfit} \
{accessories} \
{aura} \
{symbols} \
{effects} \
{backgrounds} \
{decorations} \
{badges} \
{nft.AvatarChangeTable} \
--json 

```
参数解释：

Input parameter description:

* `{nft.PackageId}`：NFT 合约包 ID（NFT Contract Package ID）。
* `{avatarId}`： 类型为 `ID`。玩家的 NFT(PFP) 的 ID。
* `{publisherId}`： 类型为 `&sui::package::Publisher`。合约包发布者对象 ID（Contract package publisher object ID）。
* `{image_url}`： 类型为 `String`。NFT 头像图片 URL（NFT image URL）。
* `{background_color}`： 类型为 `Option<u32>`。背景颜色(Background color)。
* `{haircut}`：类型为 `Option<u8>`。发型(Haircut)。
* `{outfit}`：类型为 `Option<u8>`。搭配(Outfit)。
* `{accessories}`：类型为 `Option<u8>`。配饰(Accessory)。
* `{aura}`：类型为 `vector<u8>`。光晕数组(Aura vector)。
* `{symbols}`：类型为 `vector<u8>`。符号数组(Symbol vector)。
* `{effects}`：类型为 `vector<u8>`。作用影响效果数组(effect vector)。
* `{backgrounds}`：类型为 `vector<u8>`。背景数组(Background vector)。
* `{decorations}`：类型为 `vector<u8>`。装饰数组(Decoration vector)。
* `{badges}`：类型为 `vector<u8>`。徽章数组(Badge vector)。
* `{nft.AvatarChangeTable}` 类型为 `&mut AvatarChangeTable`。保存玩家 NTF(PFP) 动态属性变化的表对象 ID。


执行成功，将得到如下相似的 JSON 格式输出结果（部分）：

After successful command execution, you will receive an output with a JSON structure similar to the following:

```json

  "objectChanges": [
    {
      "type": "created",
      "sender": "0x8f50309b7d779c29e1eab23889b9553e8874d2b9e106b944ec06f925c0ca4450",
      "owner": {
        "Shared": {
          "initial_shared_version": 77043847
        }
      },
      "objectType": "0xd03934bda3e2bdb3129535eb654028b07cc17a019a6e9cc0a05f0ab4583b5b45::avatar_change::AvatarChange",
      "objectId": "0x1201683df2dac331d0a34620df3ce017b35c812e824bf95812ce8a3121618160",
      "version": "77043847",
      "digest": "3JpwaEb9yNGZzmqLjjbgL5F9aZFiMK9VsvqU96rPG61D"
    }
  ]
```
从上述结果中，可以看到类型为 `{nft.packageId}::avatar_change::AvatarChange` 的元素，我们将其 `objectId` 记录为 `{avatarChangeId}`。
我们将在 `更新 AvatarChange` 以及 `更新 NFT(PFP)`接口函数中使用它。


### 更新 NFT 变更信息（Update AvatarChange Object）

正如 `创建 NFT(PFP) 变更信息` 中所言，当需要玩家的活动造成其 `NFT(PFP)` 对象中的动态属性的值变化时，如果与 `NFT(PFP)` 对应的 `AvatarChange` 对象已经存在，
应该先更新该对象，然后再使用它更新 `NFT(PFP)` 对象。

可以通过执行以下 `Sui CLI` 命令来更新 `AvatarChange` 对象：

Update the `AvatarChange` object by executing the following `Sui CLI` command:

```shell
sui client call --package {nft.packageId} --module avatar_change_aggregate --function update --args \
{avatarChangeId} \
{nft.Publisher} \
{image_url} \
{background_color} \
{haircut} \
{outfit} \
{accessories} \
{aura} \
{symbols} \
{effects} \
{backgrounds} \
{decorations} \
{badges} \
--json 

```
参数解释：

Input parameter description:

* `{nft.PackageId}`：NFT 合约包 ID（NFT Contract Package ID）。
* `{AvatarChangeId}`： 类型为 `ID`。玩家的 NFT(PFP) 对应的 `AvatarChangeId` 的 ID。
* `{publisherId}`： 类型为 `&sui::package::Publisher`。合约包发布者对象 ID（Contract package publisher object ID）。
* `{image_url}`： 类型为 `String`。NFT 头像图片 URL（NFT image URL）。
* `{background_color}`： 类型为 `Option<u32>`。背景颜色(Background color)。
* `{haircut}`：类型为 `Option<u8>`。发型(Haircut)。
* `{outfit}`：类型为 `Option<u8>`。搭配(Outfit)。
* `{accessories}`：类型为 `Option<u8>`。配饰(Accessory)。
* `{aura}`：类型为 `vector<u8>`。光晕数组(Aura vector)。
* `{symbols}`：类型为 `vector<u8>`。符号数组(Symbol vector)。
* `{effects}`：类型为 `vector<u8>`。作用影响效果数组(effect vector)。
* `{backgrounds}`：类型为 `vector<u8>`。背景数组(Background vector)。
* `{decorations}`：类型为 `vector<u8>`。装饰数组(Decoration vector)。
* `{badges}`：类型为 `vector<u8>`。徽章数组(Badge vector)。



### 更新 NFT（Update NFT） 

当玩家的活动造成其 `NFT(PFP)` 中的相关属性值变化时，在创建或更新与 `NFT(PFP)` 对应的 `AvatarChange` 对象后，还应继续更新 `NFT(PFP)`。

可以通过执行以下 `Sui CLI` 命令来更新 `NFT(PFP)` 对象：

Update `NFT(PFP)` object by executing the following `Sui CLI` command:

```shell
sui client call --package {nft.packageId} --module avatar_aggregate --function update --args \
{avatarId} \
{avatarChangeId} \
--json 

```
参数解释：

Input parameter description:

* `{nft.PackageId}`：NFT 合约包 ID（NFT Contract Package ID）。
* `{avatarId}`： 类型为 `ID`。玩家的 `NFT(PFP)` 的 ID。
* `{AvatarChangeId}`： 类型为 `ID`。玩家的 `NFT(PFP)` 对象对应的 `AvatarChange` 对象 ID。


### 销毁 NFT(Destroy NFT)

可以通过执行以下 `Sui CLI` 命令来销毁 `NFT(PFP)` 对象：

Execute the following `Sui CLI` command to destroy `NFT(PFP)` object:

```shell
sui client call --package {nft.packageId} --module avatar_aggregate --function burn --args {avatarId} --json 

```
参数解释：

Input parameter description:

* `{nft.PackageId}`：NFT 合约包 ID（NFT Contract Package ID）。
* `{avatarId}`： 类型为 `ID`。玩家的 `NFT(PFP)` 的 ID。


### Add Entry to the whitelist

管理员可以通过以下 `Sui CLI` 命令向白名单中添加一条记录：

Admin can add an entry to the whitelist using the following `Sui CLI` command:

```shell
sui client call --package {nft.packageId} --module whitelist_aggregate --function add_whitelist_entry --args \
{nft.whitelist} \
{nft.Publisher} \
{account_address} \
{name} \
{image_url} \
{description} \ 
{background_color} \
{race} \ 
{eyes} \ 
{mouth} \ 
{haircut} \ 
{skin} \ 
{outfit} \ 
{accessories} \ 
--json
```

参数解释：

Input parameter description:

* `{nft.PackageId}`：NFT 合约包 ID（NFT Contract Package ID）。
* `{nft.whitelist}`： 类型为 `&mut Whitelist`。白名单对象 ID（Whitelist object ID）。
* `{publisherId}`： 类型为 `&sui::package::Publisher`。合约包发布者对象 ID（Contract package publisher object ID）。
* `{account_address}`： 类型为 `address`。加入白名单的账号地址（The account address to be added to the white order）。
* `{name}`： 类型为 `String`。NFT 的名称（Name of NFT）。
* `{image_url}`： 类型为 `String`。NFT 头像图片 URL（NFT image URL）。
* `{description}`： 类型为 `String`。NFT 的描述信息（Description of NFT）。
* `{background_color}`： 类型为 `u32`。背景颜色(Background color)。
* `{race}`：类型为 `u8`。种族(Race)。
* `{eyes}`：类型为 `u8`。眼睛(eyes)。
* `{mouth}`：类型为 `u8`。嘴巴(mouth)。
* `{haircut}`：类型为 `u8`。发型(Haircut)。
* `{skin}`：类型为 `u8`。皮肤(Skin)。
* `{outfit}`：类型为 `u8`。搭配(Outfit)。
* `{accessories}`：类型为 `u8`。配件(Accessory)。


### 更新白名单记录(Update whitelist entry)

通过以下 `Sui CLI` 命令更改白名单中的指定地址对应的记录信息：

Update the entry information corresponding to the specified address in the whitelist using the following `Sui CLI` command:

```shell
sui client call --package {nft.packageId} --module whitelist_aggregate --function update_whitelist_entry --args \
{nft.whitelist} \
{nft.Publisher} \
{account_address} \
{name} \
{image_url} \
{description} \ 
{background_color} \
{race} \ 
{eyes} \ 
{mouth} \ 
{haircut} \ 
{skin} \ 
{outfit} \ 
{accessories} \
{claimed} \
{paused} \
--json
```

参数解释：

Input parameter description:

* `{nft.PackageId}`：NFT 合约包 ID（NFT Contract Package ID）。
* `{nft.whitelist}`： 类型为 `&mut Whitelist`。白名单对象 ID（Whitelist object ID）。
* `{publisherId}`： 类型为 `&sui::package::Publisher`。合约包发布者对象 ID（Contract package publisher object ID）。
* `{account_address}`： 类型为 `address`。加入白名单的账号地址（Account addresses that have been added to the whitelist）。
* `{name}`： 类型为 `String`。NFT 的名称（Name of NFT）。
* `{image_url}`： 类型为 `String`。NFT 头像图片 URL（NFT image URL）。
* `{description}`： 类型为 `String`。NFT 的描述信息（Description of NFT）。
* `{background_color}`： 类型为 `u32`。背景颜色(Background color)。
* `{race}`：类型为 `u8`。种族(Race)。
* `{eyes}`：类型为 `u8`。眼睛(eyes)。
* `{mouth}`：类型为 `u8`。嘴巴(mouth)。
* `{haircut}`：类型为 `u8`。发型(Haircut)。
* `{skin}`：类型为 `u8`。皮肤(Skin)。
* `{outfit}`：类型为 `u8`。搭配(Outfit)。
* `{accessories}`：类型为 `u8`。配件(Accessory)。
* `{claimed}`：类型为 `bool`。地址对应的用户是否已经认领了一个 NFT。true:已经认领，false:还未认领（Has the user corresponding to the address already claimed an NFT. True: already claimed, false: not yet claimed）。
* `{paused}`：类型为 `bool`。是否允许地址对应的用户自己铸造一个 NFT。true:允许，false:不允许。（Whether to allow the user corresponding to the address to mint an NFT. true: allow, false: disallow）。

### User claims an NFT themselves 

在白名单内的用户可以利用以下 `Sui CLI` 命令自我认领一个 NFT(PFP)：

Users in the whitelist can use the following `Sui CLI` command to self claims an NFT (PFP):
```shell
sui client call --package {nft.packageId} --module avatar_aggregate --function whitelist_mint --args {nft.Whitelist} --json
```

参数解释：

Input parameter description:

* `{nft.PackageId}`：NFT 合约包 ID（NFT Contract Package ID）。
* `{nft.whitelist}`： 类型为 `&mut Whitelist`。白名单对象 ID（Whitelist object ID）。

执行成功，可以得到如下类似的输出信息：

If executed successfully, similar output information can be obtained as follows:
```json
"objectChanges": [
    {
      "type": "created",
      "sender": "0x18c9efc771fb402058703ec5842981e515dcc3bcf8c4ce05f1a4bc5f50d1a32b",
      "owner": {
        "AddressOwner": "0x18c9efc771fb402058703ec5842981e515dcc3bcf8c4ce05f1a4bc5f50d1a32b"
      },
      "objectType": "0x3a052925386eb45ef30a14cf75c393fab2a0ca10fbdf138987f310c956209191::avatar::Avatar",
      "objectId": "0x148074dcd41b3c55544a76de77d8b21515ec447bf3e055a9535e2a28c249eefe",
      "version": "80116789",
      "digest": "8eZMiHUnCqzRgQqn6Cso2anvscNQ357CjAr3Gx3vkjkS"
    }
  ]
```
可以看到 `objectType` 为 `{nft.packageId}::avatar::Avatar` 的元素，其 `objectId` 即为用户认领到的 NFT(PFP) 对象的 ID。
我们可以将其记录为 `{AvatarId}`，以供在其他地方使用。

We can see that 'objectType' is an element of '{nft. packageId}:: avatar:: Avatar', and its' objectId 'is the ID of the NFT (PFP) object claimed by the user.
We can record it as' AvatarId 'for use elsewhere.

### How to determine if an address in the whitelist has claimed an NFT

Using the `whitelist` object ID as a parameter, execute the following `Sui CLI` command:
```shell
sui client object {nft.Whitelist} --json
```
We will obtain response in the following format:
```json
{
  "objectId": "0x785c5465137ae06615f64d19901124490f8fc926a99e0c4ead6b4e6c49af3604",
  "version": "80116790",
  "digest": "13GNNxJMfFdhYUC8JvFoxfeUNQpWTG4D17yxgQwr2AJ5",
  "type": "0x3a052925386eb45ef30a14cf75c393fab2a0ca10fbdf138987f310c956209191::whitelist::Whitelist",
  "owner": {
    "Shared": {
      "initial_shared_version": 80116786
    }
  },
  "previousTransaction": "BeKqtCLdRpFaLX5BC4tFYYYz1t5AaVT4q1qqFsEA1jAN",
  "storageRebate": "1702400",
  "content": {
    "dataType": "moveObject",
    "type": "0x3a052925386eb45ef30a14cf75c393fab2a0ca10fbdf138987f310c956209191::whitelist::Whitelist",
    "hasPublicTransfer": false,
    "fields": {
      "entries": {
        "type": "0x2::table::Table<address, 0x3a052925386eb45ef30a14cf75c393fab2a0ca10fbdf138987f310c956209191::whitelist_entry::WhitelistEntry>",
        "fields": {
          "id": {
            "id": "0xebe9a79a94b366edecd97e3e7ec3f1714042e98a26562b9075d144a152a777ca"
          },
          "size": "1"
        }
      },
      "id": {
        "id": "0x785c5465137ae06615f64d19901124490f8fc926a99e0c4ead6b4e6c49af3604"
      },
      "paused": false,
      "version": "2"
    }
  }
}
```

Call the following command with `{content.fields.entries.id.id}` as a parameter in the returned result:
```shell
curl -X POST -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","id":1,"method":"suix_getDynamicFields","params":["{content.fields.entries.id.id}"]}' https://fullnode.testnet.sui.io/
```
We will obtain response in the following format:
```json
{
	"jsonrpc": "2.0",
	"result": {
		"data": [{
			"name": {
				"type": "address",
				"value": "0x18c9efc771fb402058703ec5842981e515dcc3bcf8c4ce05f1a4bc5f50d1a32b"
			},
			"bcsName": "2fmNxP6CKYJuBb7VmEgsSW6daaPbfXPznF98Hqp6Bbmk",
			"type": "DynamicField",
			"objectType": "0x3a052925386eb45ef30a14cf75c393fab2a0ca10fbdf138987f310c956209191::whitelist_entry::WhitelistEntry",
			"objectId": "0xa38e2dd227664297bf968c8ab5b86bd86b5a386d5dc93fcbc9c4bf0120289873",
			"version": 80116789,
			"digest": "GmojBHr7t9uinrubmp5VbQpbGUFRt6cPF8zifb1KDejH"
		}],
		"nextCursor": "0xa38e2dd227664297bf968c8ab5b86bd86b5a386d5dc93fcbc9c4bf0120289873",
		"hasNextPage": false
	},
	"id": 1
}
```
The `data` element is an array. The value of the `name.value` attribute of each element in the array is the address in the whitelist. 
We can see that the value of `objectType` is `{nft.packageId}::whitelist_entry::WhitelistEntry`, and we record the value of `objectId` as `{WhitelistEntryId}`.


Using `{WhitelistEntryId}` as a parameter to execute the following `Sui CLI` command:
```shell
sui client object {WhitelistEntryId} --json
```
We will obtain response in the following format:
```json
{
  "objectId": "0xa38e2dd227664297bf968c8ab5b86bd86b5a386d5dc93fcbc9c4bf0120289873",
  "content": {
    "dataType": "moveObject",
    "type": "0x2::dynamic_field::Field<address, 0x3a052925386eb45ef30a14cf75c393fab2a0ca10fbdf138987f310c956209191::whitelist_entry::WhitelistEntry>",
    "hasPublicTransfer": false,
    "fields": {
      "id": {
        "id": "0xa38e2dd227664297bf968c8ab5b86bd86b5a386d5dc93fcbc9c4bf0120289873"
      },
      "name": "0x18c9efc771fb402058703ec5842981e515dcc3bcf8c4ce05f1a4bc5f50d1a32b",
      "value": {
        "type": "0x3a052925386eb45ef30a14cf75c393fab2a0ca10fbdf138987f310c956209191::whitelist_entry::WhitelistEntry",
        "fields": {
          "accessories": 8,
          "account_address": "0x18c9efc771fb402058703ec5842981e515dcc3bcf8c4ce05f1a4bc5f50d1a32b",
          "background_color": 1,
          "claimed": true,
          "description": "description",
          "eyes": 3,
          "haircut": 5,
          "image_url": "http://www.baidu.com/logo.png",
          "mouth": 4,
          "name": "Enlai",
          "outfit": 7,
          "paused": false,
          "race": 2,
          "skin": 6
        }
      }
    }
  }
}
```
Let's find the element:`content.fields.value.fields.claimed`, which has a Boolean value.
If the value is true, it means that the user has already claimed an NFT, otherwise it is not claimed.


[TBD]

### 关于 Move Table 或者 ObjectTable 内容的查询

使用 `sui client object {OBJECT_ID}` 命令查询一个对象，如果对象包含类型为 `Table` 或者 `ObjectTable` 类型的字段，
那么这个字段的信息输出类似下面这样：

```text
"items": {
        "type": "0x2::table::Table<{KEY_TYPE}, {VALUE_TYPE}>",
        "fields": {
          "id": {
            "id": "0x600ff5d855b5d9ff63edd9d9215457e1c1f6cbb316dc95999ac0d180c886e197"
          },
          "size": "2"
        }
      },
```

在上面的示例输出中，“表”（table）的 ID 是 `0x600ff5d855b5d9ff63edd9d9215457e1c1f6cbb316dc95999ac0d180c886e197`。
然后我们可以这样获取 table 的“动态字段”（你可以把动态字段理解为表的“行”）——这是个“分页”查询接口：

```shell
curl -X POST \
-H "Content-Type: application/json" \
-d '{"jsonrpc":"2.0","id":1,"method":"suix_getDynamicFields","params":["0x600ff5d855b5d9ff63edd9d9215457e1c1f6cbb316dc95999ac0d180c886e197"]}' \
https://fullnode.testnet.sui.io/
```

如果获取的是 `Table` 类型的“表”，那么，返回的分页内容类似下面这样：

```text
{"jsonrpc":"2.0","result":{"data":[
{"name":{"type":"u32","value":1},"bcsName":"2UzHM","type":"DynamicField","objectType":"0x14ba8a9763d9883be8dcedce946efc25e5cbc80c4b8f09d1dbc89731fa517fb8::player_item::PlayerItem",
"objectId":"0x8655ebf801c0d9f734bc09b9b6aaff781f4d18c66e8ea4e0cb6261315f7b5bee","version":26421773,"digest":"4dCkgDHtD9cbQAz7P9Lveetm7PfSC8DbABfySHYmgTgy"},
{"name":{"type":"u32","value":2},"bcsName":"3xyZh","type":"DynamicField","objectType":"0x14ba8a9763d9883be8dcedce946efc25e5cbc80c4b8f09d1dbc89731fa517fb8::player_item::PlayerItem",
"objectId":"0x970ccbbd1b5670c4f1e13c8a8eafddf53c0a579b158129e961046ee6c321c739","version":26421895,"digest":"4BnmTVdyAgVT8qN7um8h1CXdWpHqjYPQsyMTmYWKaCjr"}
],"nextCursor":"0x970ccbbd1b5670c4f1e13c8a8eafddf53c0a579b158129e961046ee6c321c739","hasNextPage":false},"id":1}
```

返回的分页列表中的元素，`"type":"DynamicField"`，你可以这些元素理解为“动态字段”的“引用”，而不是动态字段的内容的全部。
然后，再像下面这样，通过动态字段的 ID，获取“动态字段”的内容（动态字段也是一个“对象”）：

```shell
sui client object 0x8655ebf801c0d9f734bc09b9b6aaff781f4d18c66e8ea4e0cb6261315f7b5bee

sui client object 0x970ccbbd1b5670c4f1e13c8a8eafddf53c0a579b158129e961046ee6c321c739
```

---

如果获取的是 `ObjectTable` 类型的表，
那么，`suix_getDynamicFields` 方法返回分页列表中的元素，`"type":"DynamicObject"`。

### 测试链下服务（indexer）

#### Configuring off-chain service

Open the `application-test.yml` file located in the directory `sui-java-service/suiinfinitesea-service-rest/src/main/resources` and set the publishing transaction digests.

After setting, it should look like this:

```yaml
sui:
  contract:
    jsonrpc:
      url: "https://fullnode.testnet.sui.io/"
    package-publish-transactions:
      common: "{COMMON_PACKAGE_PUBLISH_TRANSACTION_DIGEST}"
      default: "{DEFAULT_PACKAGE_PUBLISH_TRANSACTION_DIGEST}"
```

This is the only place where off-chain service need to be configured, and it's that simple.

#### Creating a database for off-chain service

Use a MySQL client to connect to the local MySQL server and execute the following script to create an empty database (assuming the name is `test7`):

```sql
CREATE SCHEMA `test7` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;
```

Go to the `sui-java-service` directory and package the Java project:

```shell
mvn package
```

Then, run a command-line tool to initialize the database:

```shell
java -jar ./suiinfinitesea-service-cli/target/suiinfinitesea-service-cli-0.0.1-SNAPSHOT.jar ddl -d "./scripts" -c "jdbc:mysql://127.0.0.1:3306/test7?enabledTLSProtocols=TLSv1.2&characterEncoding=utf8&serverTimezone=GMT%2b0&useLegacyDatetimeCode=false" -u root -p 123456
```

#### Starting off-chain service

In the `sui-java-service` directory, execute the following command to start the off-chain service:

```shell
mvn -pl suiinfinitesea-service-rest -am spring-boot:run
```

