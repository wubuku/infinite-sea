singletonObjects:
  Map:
    module: "Map"
    metadata:
      IS_MOVE_SCHEMA_VERSIONED: true
    friends:
      - Player.ClaimIsland
      - Player.GatherIslandResources
    properties:
      Locations:
        itemType: MapLocation
    entities:
      MapLocation:
        id:
          name: Coordinates
          type: Coordinates
        properties:
          Type:
            type: u32
          OccupiedBy:
            type: ID # PlayerId
            optional: true
          Resources:
            itemType: ItemIdQuantityPair
          GatheredAt:
            type: u64
    methods:
      "__Init__":
        event:
          isObjectShared: true # Share the object after initialization.

      AddIsland:
        requiredPermission: "AdminCap"
        parameters:
          Coordinates:
            type: Coordinates
          Resources:
            type: ItemIdQuantityPairs
        event:
          name: IslandAdded

      ClaimIsland:
        metadata:
          IsExternalFriendly: true
        #isInternal: true
        parameters:
          Coordinates:
            type: Coordinates
          ClaimedBy:
            type: ID # PlayerId
          ClaimedAt:
            type: u64
        event:
          name: MapIslandClaimed

      GatherIslandResources:
        metadata:
          ParametersIncludedInMutationFunction: [ "Clock" ]
          IsExternalFriendly: true
        #isInternal: true
        parameters:
          #Player:
          #  referenceType: Player
          #  isMutableReference: true
          #  isIgnoredInEvent: true
          PlayerId:
            type: ID
          Coordinates:
            type: Coordinates
          Clock:
            referenceType: Clock
            isIgnoredInEvent: true
        result:
          type: ItemIdQuantityPairs
        event:
          name: IslandResourcesGathered
          properties:
            Coordinates:
              type: Coordinates
            Resources:
              itemType: ItemIdQuantityPair
            GatheredAt:
              type: u64
